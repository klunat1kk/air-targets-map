<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">
    <title>–ö–∞—Ä—Ç–∞ –ü–æ–≤—ñ—Ç—Ä—è–Ω–∏—Ö –¶—ñ–ª–µ–π - –†–æ–∑—à–∏—Ä–µ–Ω–∞ –≤–µ—Ä—Å—ñ—è</title>
    
    <!-- External Libraries -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" 
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" 
      crossorigin="anonymous"/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" 
      crossorigin="anonymous"/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" 
      crossorigin="anonymous"/>
    <link rel="stylesheet" href="frontend/css/fontawesome.css">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="frontend/css/leaflet.contextmenu.css">

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin="anonymous"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"
            crossorigin="anonymous"></script>
    <script src="frontend/js/leaflet.contextmenu.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0c0e2a 0%, #1e2142 100%);
            color: #fff;
            overflow: hidden;
            height: 100vh;
        }

        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            width: 100vw;
        }

        .header {
            background: linear-gradient(90deg, #2d3436 0%, #2c3e50 100%);
            padding: 12px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            border-bottom: 2px solid #00cec9;
            flex-shrink: 0;
        }

        .header h1 {
            font-size: 20px;
            font-weight: bold;
            color: #00cec9;
            text-shadow: 0 0 10px rgba(0, 206, 201, 0.5);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 30%;
        }

        .header h1 i {
            margin-right: 8px;
        }

        .search-container {
            position: relative;
            flex: 1;
            max-width: 400px;
            margin: 0 20px;
        }

        .search-box {
            position: relative;
            display: flex;
            align-items: center;
        }

        #searchInput {
            width: 100%;
            padding: 10px 40px 10px 15px;
            border: 2px solid #34495e;
            border-radius: 25px;
            background: #2d3436;
            color: #fff;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        #searchInput:focus {
            outline: none;
            border-color: #00cec9;
            box-shadow: 0 0 10px rgba(0, 206, 201, 0.5);
        }

        .search-btn {
            position: absolute;
            right: 10px;
            background: none;
            border: none;
            color: #00cec9;
            cursor: pointer;
            font-size: 16px;
            padding: 5px;
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: #2d3436;
            border: 2px solid #34495e;
            border-top: none;
            border-radius: 0 0 5px 5px;
            max-height: 200px;
            overflow-y: auto;
            display: none;
            z-index: 1000;
        }

        .search-result-item {
            padding: 10px;
            cursor: pointer;
            border-bottom: 1px solid #34495e;
            transition: background-color 0.2s;
        }

        .search-result-item:hover {
            background: #34495e;
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .header-controls {
            display: flex;
            gap: 8px;
            flex-wrap: nowrap;
        }

        .header-btn {
            background: linear-gradient(90deg, #0984e3 0%, #00cec9 100%);
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
            white-space: nowrap;
        }

        .header-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 206, 201, 0.4);
        }

        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
            flex-direction: column;
        }

        #map {
            flex: 1;
            z-index: 1;
            position: relative;
        }

        .crosshair {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            z-index: 999;
            pointer-events: none;
        }

        .crosshair::before, .crosshair::after {
            content: '';
            position: absolute;
            background: rgba(0, 206, 201, 0.8);
        }

        .crosshair::before {
            width: 2px;
            height: 40px;
            left: 50%;
            transform: translateX(-50%);
        }

        .crosshair::after {
            width: 40px;
            height: 2px;
            top: 50%;
            transform: translateY(-50%);
        }

        .map-switcher {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
            background: rgba(44, 62, 80, 0.9);
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #00cec9;
        }

        .map-switcher select {
            background: #2d3436;
            color: white;
            border: 1px solid #34495e;
            border-radius: 3px;
            padding: 5px;
        }

        /* –ù–æ–≤–∞—è —É–ª—É—á—à–µ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å —Å –≤–∫–ª–∞–¥–∫–∞–º–∏ */
        .panel {
            width: 100%;
            height: 350px;
            background: rgba(30, 33, 66, 0.95);
            overflow: hidden;
            transition: all 0.3s ease;
            border-top: 2px solid #00cec9;
            box-shadow: 0 -5px 15px rgba(0, 0, 0, 0.3);
            flex-shrink: 0;
        }

        .panel.collapsed {
            height: 50px;
        }

        .panel-tabs {
            display: flex;
            background: rgba(44, 62, 80, 0.8);
            border-bottom: 1px solid #34495e;
        }

        .panel-tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            border-right: 1px solid #34495e;
            transition: all 0.3s ease;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .panel-tab:last-child {
            border-right: none;
        }

        .panel-tab.active {
            background: linear-gradient(90deg, #0984e3 0%, #00cec9 100%);
            color: white;
        }

        .panel-tab:hover:not(.active) {
            background: rgba(52, 73, 94, 0.8);
        }

        .panel-content {
            height: calc(100% - 50px);
            overflow-y: auto;
            padding: 15px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .panel-section {
            margin-bottom: 15px;
            background: rgba(44, 62, 80, 0.6);
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #34495e;
        }

        .panel-section h3 {
            color: #00cec9;
            margin-bottom: 12px;
            font-size: 16px;
            border-bottom: 2px solid #00cec9;
            padding-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-group {
            margin-bottom: 12px;
        }

        .form-row {
            display: flex;
            gap: 10px;
        }

        .form-row .form-group {
            flex: 1;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #dfe6e9;
            font-weight: 500;
            font-size: 14px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #34495e;
            border-radius: 5px;
            background: #2d3436;
            color: #fff;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #00cec9;
            box-shadow: 0 0 10px rgba(0, 206, 201, 0.5);
        }

        .color-picker {
            width: 100%;
            height: 40px;
            border: 2px solid #34495e;
            border-radius: 5px;
            cursor: pointer;
        }

        .range-input {
            width: 100%;
            margin: 10px 0;
        }

        .btn {
            background: linear-gradient(90deg, #0984e3 0%, #00cec9 100%);
            border: none;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 5px;
            font-size: 14px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 206, 201, 0.4);
        }

        .btn-small {
            padding: 6px 10px;
            font-size: 12px;
            width: auto;
            margin: 2px;
        }

        .btn-danger {
            background: linear-gradient(90deg, #e74c3c 0%, #c0392b 100%);
        }

        .btn-secondary {
            background: linear-gradient(90deg, #7f8c8d 0%, #636e72 100%);
        }

        .btn-success {
            background: linear-gradient(90deg, #27ae60 0%, #2ecc71 100%);
        }

        .btn-margin {
            margin-top: 10px;
        }

        .targets-list {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
        }

        .target-item {
            background: rgba(52, 73, 94, 0.6);
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 6px;
            border-left: 4px solid #00cec9;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .target-item:hover {
            background: rgba(52, 73, 94, 0.9);
            transform: translateX(5px);
        }

        .target-item h4 {
            color: #00cec9;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
        }

        .target-item p {
            color: #dfe6e9;
            font-size: 12px;
            margin: 2px 0;
        }

        .target-item .target-actions {
            display: flex;
            gap: 5px;
            margin-top: 8px;
        }

        .target-item .target-actions button {
            flex: 1;
            padding: 4px;
            font-size: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .stat-card {
            background: rgba(52, 73, 94, 0.6);
            padding: 12px;
            border-radius: 6px;
            text-align: center;
            border: 1px solid #34495e;
        }

        .stat-card h4 {
            color: #00cec9;
            font-size: 18px;
            margin-bottom: 5px;
        }

        .stat-card p {
            color: #dfe6e9;
            font-size: 11px;
        }

        .status-bar {
            background: rgba(44, 62, 80, 0.9);
            padding: 8px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top: 2px solid #00cec9;
            font-size: 12px;
            flex-shrink: 0;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .online-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #00b894;
            animation: pulse 2s infinite;
        }

        .offline-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #d63031;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: linear-gradient(135deg, #2d3436 0%, #2c3e50 100%);
            margin: 5% auto;
            padding: 20px;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
            border: 2px solid #00cec9;
            position: relative;
        }

        .modal-content h3 {
            color: #00cec9;
            margin-bottom: 15px;
            text-align: center;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .modal-buttons {
            display: flex;
            gap: 12px;
            margin-top: 15px;
        }

        .modal-buttons button {
            flex: 1;
            padding: 10px;
            font-size: 14px;
            font-weight: bold;
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            color: #00cec9;
            font-size: 20px;
            cursor: pointer;
        }

        .course-notification {
            position: fixed;
            top: 15px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(90d, #0984e3 0%, #00cec9 100%);
            color: white;
            padding: 12px 20px;
            border-radius: 6px;
            z-index: 1001;
            box-shadow: 0 4px 15px rgba(0, 206, 201, 0.5);
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: bold;
            font-size: 14px;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–π */
        .trajectory-settings {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .pattern-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-top: 10px;
        }

        .pattern-btn {
            padding: 8px;
            border: 2px solid #34495e;
            background: rgba(52, 73, 94, 0.6);
            color: white;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 12px;
        }

        .pattern-btn:hover {
            border-color: #00cec9;
            background: rgba(0, 206, 201, 0.2);
        }

        .pattern-btn.active {
            border-color: #00cec9;
            background: linear-gradient(90deg, #0984e3 0%, #00cec9 100%);
        }

        /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –º–∞—Ä–∫–µ—Ä–æ–≤ */
        .png-icon-marker {
            background: transparent !important;
            border: none !important;
        }

        .rotatable-png-icon {
            width: 40px;
            height: 40px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            transition: transform 0.5s ease;
            transform-origin: center;
        }

        .marker-cluster {
            background: rgba(231, 76, 60, 0.8);
            border-radius: 50%;
            color: white;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 3px solid white;
            box-shadow: 0 0 15px rgba(231, 76, 60, 0.8);
        }

        .marker-cluster-small {
            width: 40px;
            height: 40px;
            font-size: 14px;
        }

        .marker-cluster-medium {
            width: 50px;
            height: 50px;
            font-size: 16px;
        }

        .marker-cluster-large {
            width: 60px;
            height: 60px;
            font-size: 18px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 18px;
                max-width: 30%;
            }
            
            .search-container {
                max-width: 250px;
                margin: 0 10px;
            }
            
            .header-btn {
                padding: 6px 10px;
                font-size: 12px;
            }
            
            .panel {
                height: 300px;
            }
            
            .panel.collapsed {
                height: 45px;
            }
            
            .modal-content {
                width: 95%;
                margin: 10% auto;
            }

            .panel-tabs {
                flex-wrap: wrap;
            }

            .panel-tab {
                min-width: 25%;
                font-size: 12px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 10px;
                flex-wrap: wrap;
            }
            
            .header h1 {
                font-size: 16px;
                max-width: 100%;
                margin-bottom: 10px;
                order: 1;
            }
            
            .search-container {
                order: 3;
                max-width: 100%;
                margin: 10px 0 0 0;
            }
            
            .header-controls {
                order: 2;
                width: 100%;
                justify-content: space-between;
            }
            
            .header-btn {
                padding: 5px 8px;
                font-size: 11px;
            }
            
            .header-btn span {
                display: none;
            }

            .form-row {
                flex-direction: column;
            }

            .trajectory-settings {
                grid-template-columns: 1fr;
            }

            .pattern-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes slideIn {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .target-item {
            animation: slideIn 0.3s ease;
        }

        .notification {
            animation: fadeIn 0.3s ease;
        }

        /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –≤—Å–ø–ª—ã–≤–∞—é—â–∏—Ö –æ–∫–æ–Ω */
        .leaflet-popup-content-wrapper {
            background: linear-gradient(135deg, #2d3436 0%, #2c3e50 100%);
            color: white;
            border-radius: 8px;
            box-shadow: 0 3px 14px rgba(0,0,0,.4);
        }

        .leaflet-popup-content {
            margin: 12px 16px;
            font-size: 14px;
        }

        .target-info-window h4 {
            color: #00cec9;
            margin-bottom: 8px;
            border-bottom: 1px solid #00cec9;
            padding-bottom: 4px;
        }

        .target-info-window p {
            margin: 4px 0;
            color: #dfe6e9;
        }

        .action-buttons {
            display: flex;
            gap: 5px;
            margin-top: 8px;
        }

        .action-button {
            flex: 1;
            padding: 6px;
            font-size: 11px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .edit-btn {
            background: linear-gradient(90deg, #f39c12 0%, #e67e22 100%);
            color: white;
        }

        .delete-btn {
            background: linear-gradient(90deg, #e74c3c 0%, #c0392b 100%);
            color: white;
        }

        .course-btn {
            background: linear-gradient(90deg, #9b59b6 0%, #8e44ad 100%);
            color: white;
        }

        .action-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        /* –£–ª—É—á—à–µ–Ω–Ω—ã–π —Å–∫—Ä–æ–ª–ª–±–∞—Ä */
        .panel-content::-webkit-scrollbar,
        .targets-list::-webkit-scrollbar {
            width: 8px;
        }

        .panel-content::-webkit-scrollbar-track,
        .targets-list::-webkit-scrollbar-track {
            background: rgba(52, 73, 94, 0.3);
            border-radius: 4px;
        }

        .panel-content::-webkit-scrollbar-thumb,
        .targets-list::-webkit-scrollbar-thumb {
            background: rgba(0, 206, 201, 0.6);
            border-radius: 4px;
        }

        .panel-content::-webkit-scrollbar-thumb:hover,
        .targets-list::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 206, 201, 0.8);
        }
    </style>
</head>
<body>
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º -->
    <div id="warningModal" class="modal" style="display: block;">
        <div class="modal-content" style="max-width: 600px;">
            <h3><i class="fas fa-exclamation-triangle" style="color: #f39c12;"></i> –£–í–ê–ì–ê</h3>
            <div style="max-height: 300px; overflow-y: auto; margin: 15px 0;">
                <p style="color: #dfe6e9; line-height: 1.6; font-size: 14px;">
                    <strong>–î–∞–Ω—ñ –±–µ—Ä—É—Ç—å—Å—è –∑ –≤—ñ–¥–∫—Ä–∏—Ç–∏—Ö –¥–∂–µ—Ä–µ–ª (Telegram —Ç–æ—â–æ) —Ç–∞ –º–æ–∂—É—Ç—å –º—ñ—Å—Ç–∏—Ç–∏ –ø–æ—Ö–∏–±–∫–∏.</strong><br><br>
                    
                    ‚Ä¢ –í—Å—ñ —Ü—ñ–ª—ñ –¥–æ–¥–∞—é—Ç—å—Å—è –Ω–∞ –∫–∞—Ä—Ç—É –≤—Ä—É—á–Ω—É<br>
                    ‚Ä¢ –°–µ—Ä–≤—ñ—Å –Ω–µ —î –æ—Ñ—ñ—Ü—ñ–π–Ω–æ—é —Å–∏—Å—Ç–µ–º–æ—é –æ–ø–æ–≤—ñ—â–µ–Ω–Ω—è<br>
                    ‚Ä¢ –ù–µ –∑–∞–º—ñ–Ω—é—î —Å–∏–≥–Ω–∞–ª—ñ–≤ –ü–æ–≤—ñ—Ç—Ä—è–Ω–æ—ó —Ç—Ä–∏–≤–æ–≥–∏<br>
                    ‚Ä¢ –ù–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –¥–ª—è –∫–æ—Ä–∏–≥—É–≤–∞–Ω–Ω—è –≤–æ–≥–Ω—é<br>
                    ‚Ä¢ –ù–µ —Ä–æ–∑–∫—Ä–∏–≤–∞–π—Ç–µ –ø–æ–∑–∏—Ü—ñ—ó –°–∏–ª –û–±–æ—Ä–æ–Ω–∏<br><br>
                    
                    <strong>–ó–∞–≤–∂–¥–∏ –¥–æ—Ç—Ä–∏–º—É–π—Ç–µ—Å—å –≤–∫–∞–∑—ñ–≤–æ–∫ –æ—Ñ—ñ—Ü—ñ–π–Ω–∏—Ö –æ—Ä–≥–∞–Ω—ñ–≤!</strong><br><br>
                    
                    <strong style="color: #00cec9;">üöÄ –ù–æ–≤—ñ —Ñ—É–Ω–∫—Ü—ñ—ó —Ä–æ–∑—à–∏—Ä–µ–Ω–æ—ó –≤–µ—Ä—Å—ñ—ó:</strong><br>
                    ‚Ä¢ –ü–æ–∫—Ä–∞—â–µ–Ω—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ç—Ä–∞—î–∫—Ç–æ—Ä—ñ–π<br>
                    ‚Ä¢ –ù–æ–≤—ñ –ø–∞—Ç—Ç–µ—Ä–Ω–∏ —Ä—É—Ö—É —Ü—ñ–ª–µ–π<br>
                    ‚Ä¢ –†–æ–∑—à–∏—Ä–µ–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞<br>
                    ‚Ä¢ –ì—Ä—É–ø–∏ —Ü—ñ–ª–µ–π —Ç–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó<br>
                    ‚Ä¢ –ë—ñ–ª—å—à –≥–Ω—É—á–∫—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è
                </p>
            </div>
            <div class="modal-buttons">
                <button onclick="closeWarningModal()" class="btn btn-success">–ó—Ä–æ–∑—É–º—ñ–ª–æ</button>
            </div>
        </div>
    </div>
    
    <div class="app-container">
        <div class="header">
            <h1><i class="fas fa-crosshairs"></i><span>–ö–∞—Ä—Ç–∞ –ü–æ–≤—ñ—Ç—Ä—è–Ω–∏—Ö –¶—ñ–ª–µ–π - –†–æ–∑—à–∏—Ä–µ–Ω–∞</span></h1>
            
            <div class="search-container">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="–ü–æ—à—É–∫ –º—ñ—Å—Ç–∞ –∞–±–æ —Å–µ–ª–∞...">
                    <button class="search-btn" onclick="performSearch()">
                        <i class="fas fa-search"></i>
                    </button>
                    <div id="searchResults" class="search-results"></div>
                </div>
            </div>

            <div class="header-controls">
                <button class="header-btn toggle-panel-btn" onclick="togglePanel()">
                    <i class="fas fa-eye-slash"></i><span>–ü–∞–Ω–µ–ª—å</span>
                </button>
                <button class="header-btn" onclick="toggleFullscreen()">
                    <i class="fas fa-expand"></i><span>–ü–æ–≤–Ω–∏–π –µ–∫—Ä–∞–Ω</span>
                </button>
                <button class="header-btn login-btn" onclick="showLoginModal()">
                    <i class="fas fa-user"></i><span>–£–≤—ñ–π—Ç–∏</span>
                </button>
                <button class="header-btn logout-btn" onclick="logout()" id="logoutBtn" style="display: none;">
                    <i class="fas fa-sign-out-alt"></i><span>–í–∏–π—Ç–∏</span>
                </button>
            </div>
        </div>

        <div class="main-content">
            <div id="map">
                <div class="crosshair"></div>
                <div class="map-switcher">
                    <select id="mapStyleSelector" onchange="changeMapStyle()">
                        <option value="dark">–¢–µ–º–Ω–∞ –∫–∞—Ä—Ç–∞</option>
                        <option value="standard">–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞</option>
                        <option value="satellite">–°—É–ø—É—Ç–Ω–∏–∫</option>
                    </select>
                </div>
            </div>
            
            <div class="panel" id="sidePanel">
                <div class="panel-tabs">
                    <div class="panel-tab active" data-tab="targets">
                        <i class="fas fa-bullseye"></i>
                        <span>–¶—ñ–ª—ñ</span>
                    </div>
                    <div class="panel-tab" data-tab="trajectories">
                        <i class="fas fa-route"></i>
                        <span>–¢—Ä–∞—î–∫—Ç–æ—Ä—ñ—ó</span>
                    </div>
                    <div class="panel-tab" data-tab="statistics">
                        <i class="fas fa-chart-line"></i>
                        <span>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span>
                    </div>
                    <div class="panel-tab" data-tab="settings">
                        <i class="fas fa-cogs"></i>
                        <span>–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</span>
                    </div>
                </div>
                
                <div class="panel-content">
                    <!-- –í–∫–ª–∞–¥–∫–∞ "–¶—ñ–ª—ñ" -->
                    <div id="targets-tab" class="tab-content active">
                        <div class="panel-section">
                            <h3><i class="fas fa-plus-circle"></i>–î–æ–¥–∞—Ç–∏ —Ü—ñ–ª—å</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="targetName">–ù–∞–∑–≤–∞ —Ü—ñ–ª—ñ:</label>
                                    <input type="text" id="targetName" placeholder="–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É —Ü—ñ–ª—ñ" value="–¶—ñ–ª—å-1">
                                </div>
                                <div class="form-group">
                                    <label for="targetType">–¢–∏–ø —Ü—ñ–ª—ñ:</label>
                                    <select id="targetType">
                                        <option value="–¥—Ä–æ–Ω">–î—Ä–æ–Ω</option>
                                        <option value="—Ä–∞–∫–µ—Ç–∞">–†–∞–∫–µ—Ç–∞</option>
                                        <option value="–≤–∏–Ω–∏—â—É–≤–∞—á">–í–∏–Ω–∏—â—É–≤–∞—á</option>
                                        <option value="–±–æ–º–±–∞">–ë–æ–º–±–∞</option>
                                        <option value="–∫–æ—Ä–∞–±–ª—å">–ö–æ—Ä–∞–±–µ–ª—å</option>
                                        <option value="–≤–µ—Ä—Ç–æ–ª—ñ—Ç">–í–µ—Ä—Ç–æ–ª—ñ—Ç</option>
                                        <option value="–ø—É—Å–∫–æ–≤–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∞">–ü—É—Å–∫–æ–≤–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∞</option>
                                        <option value="–≥—Ä—É–ø–∞ –±–ø–ª–∞">–ì—Ä—É–ø–∞ –ë–ø–õ–ê</option>
                                        <option value="—Ä–æ–∑–≤—ñ–¥–Ω–∏–∫">–†–æ–∑–≤—ñ–¥–Ω–∏–∫</option>
                                        <option value="–Ω–µ–≤—ñ–¥–æ–º–∞ —Ü—ñ–ª—å">–ù–µ–≤—ñ–¥–æ–º–∞ —Ü—ñ–ª—å</option>
                                        <option value="–±–∞–ª—ñ—Å—Ç–∏—á–Ω–∞ —Ä–∞–∫–µ—Ç–∞">–ë–∞–ª—ñ—Å—Ç–∏—á–Ω–∞ —Ä–∞–∫–µ—Ç–∞</option>
                                        <option value="–∫—Ä–∏–ª–∞—Ç–∞ —Ä–∞–∫–µ—Ç–∞">–ö—Ä–∏–ª–∞—Ç–∞ —Ä–∞–∫–µ—Ç–∞</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="targetSpeed">–®–≤–∏–¥–∫—ñ—Å—Ç—å (–∫–º/–≥–æ–¥):</label>
                                    <input type="number" id="targetSpeed" value="150" min="0" max="30000">
                                </div>
                                <div class="form-group">
                                    <label for="targetCourse">–ö—É—Ä—Å (0-360¬∞):</label>
                                    <input type="number" id="targetCourse" value="0" min="0" max="360">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="targetGroup">–ì—Ä—É–ø–∞:</label>
                                    <select id="targetGroup">
                                        <option value="default">–û—Å–Ω–æ–≤–Ω–∞</option>
                                        <option value="air">–ü–æ–≤—ñ—Ç—Ä—è–Ω—ñ</option>
                                        <option value="ground">–ù–∞–∑–µ–º–Ω—ñ</option>
                                        <option value="naval">–ú–æ—Ä—Å—å–∫—ñ</option>
                                        <option value="custom">–ö–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–∞</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="targetColor">–ö–æ–ª—ñ—Ä —Ç—Ä–∞—î–∫—Ç–æ—Ä—ñ—ó:</label>
                                    <input type="color" id="targetColor" class="color-picker" value="#ff0000">
                                </div>
                            </div>
                            <button class="btn" onclick="addTargetAtCenter()">
                                <i class="fas fa-plus"></i>–î–æ–¥–∞—Ç–∏ –≤ —Ü–µ–Ω—Ç—Ä
                            </button>
                        </div>

                        <div class="panel-section">
                            <h3><i class="fas fa-list"></i>–°–ø–∏—Å–æ–∫ —Ü—ñ–ª–µ–π</h3>
                            <div class="targets-list" id="targetsList"></div>
                        </div>
                    </div>

                    <!-- –í–∫–ª–∞–¥–∫–∞ "–¢—Ä–∞—î–∫—Ç–æ—Ä—ñ—ó" -->
                    <div id="trajectories-tab" class="tab-content">
                        <div class="panel-section">
                            <h3><i class="fas fa-route"></i>–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ç—Ä–∞—î–∫—Ç–æ—Ä—ñ–π</h3>
                            <div class="trajectory-settings">
                                <div class="form-group">
                                    <label for="trajectoryOpacity">–ü—Ä–æ–∑–æ—Ä—ñ—Å—Ç—å:</label>
                                    <input type="range" id="trajectoryOpacity" min="0.1" max="1" step="0.1" value="0.7" class="range-input">
                                    <span id="opacityValue">70%</span>
                                </div>
                                <div class="form-group">
                                    <label for="trajectoryWidth">–¢–æ–≤—â–∏–Ω–∞ –ª—ñ–Ω—ñ—ó:</label>
                                    <input type="range" id="trajectoryWidth" min="1" max="10" value="3" class="range-input">
                                    <span id="widthValue">3px</span>
                                </div>
                                <div class="form-group">
                                    <label for="trajectoryLength">–î–æ–≤–∂–∏–Ω–∞ —Ç—Ä–∞—î–∫—Ç–æ—Ä—ñ—ó:</label>
                                    <input type="range" id="trajectoryLength" min="5" max="100" value="20" class="range-input">
                                    <span id="lengthValue">20 —Ç–æ—á–æ–∫</span>
                                </div>
                                <div class="form-group">
                                    <label for="animationSpeed">–®–≤–∏–¥–∫—ñ—Å—Ç—å –∞–Ω—ñ–º–∞—Ü—ñ—ó:</label>
                                    <input type="range" id="animationSpeed" min="0.1" max="5" step="0.1" value="1" class="range-input">
                                    <span id="speedValue">1x</span>
                                </div>
                            </div>
                            
                            <h4 style="color: #00cec9; margin: 15px 0 10px 0;">–ü–∞—Ç—Ç–µ—Ä–Ω–∏ —Ä—É—Ö—É:</h4>
                            <div class="pattern-grid">
                                <div class="pattern-btn active" data-pattern="linear" onclick="setMovementPattern('linear')">
                                    <i class="fas fa-long-arrow-alt-right"></i><br>–õ—ñ–Ω—ñ–π–Ω–∏–π
                                </div>
                                <div class="pattern-btn" data-pattern="zigzag" onclick="setMovementPattern('zigzag')">
                                    <i class="fas fa-chart-line"></i><br>–ó–∏–≥–∑–∞–≥
                                </div>
                                <div class="pattern-btn" data-pattern="spiral" onclick="setMovementPattern('spiral')">
                                    <i class="fas fa-sync-alt"></i><br>–°–ø—ñ—Ä–∞–ª—å
                                </div>
                                <div class="pattern-btn" data-pattern="circle" onclick="setMovementPattern('circle')">
                                    <i class="fas fa-circle-notch"></i><br>–ö–æ–ª–æ
                                </div>
                                <div class="pattern-btn" data-pattern="patrol" onclick="setMovementPattern('patrol')">
                                    <i class="fas fa-exchange-alt"></i><br>–ü–∞—Ç—Ä—É–ª—å
                                </div>
                                <div class="pattern-btn" data-pattern="random" onclick="setMovementPattern('random')">
                                    <i class="fas fa-question"></i><br>–í–∏–ø–∞–¥–∫–æ–≤–∏–π
                                </div>
                            </div>
                            
                            <button class="btn btn-margin" onclick="toggleTrajectories()">
                                <i class="fas fa-eye"></i><span id="trajectoryToggleText">–ü—Ä–∏—Ö–æ–≤–∞—Ç–∏ —Ç—Ä–∞—î–∫—Ç–æ—Ä—ñ—ó</span>
                            </button>
                            <button class="btn btn-secondary btn-margin" onclick="clearAllTrajectories()">
                                <i class="fas fa-eraser"></i>–û—á–∏—Å—Ç–∏—Ç–∏ —Ç—Ä–∞—î–∫—Ç–æ—Ä—ñ—ó
                            </button>
                        </div>
                    </div>

                    <!-- –í–∫–ª–∞–¥–∫–∞ "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞" -->
                    <div id="statistics-tab" class="tab-content">
                        <div class="panel-section">
                            <h3><i class="fas fa-chart-bar"></i>–ó–∞–≥–∞–ª—å–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <h4 id="totalTargets">0</h4>
                                    <p>–í—Å—å–æ–≥–æ —Ü—ñ–ª–µ–π</p>
                                </div>
                                <div class="stat-card">
                                    <h4 id="activeTargets">0</h4>
                                    <p>–ê–∫—Ç–∏–≤–Ω–∏—Ö</p>
                                </div>
                                <div class="stat-card">
                                    <h4 id="maxSpeed">0</h4>
                                    <p>–ú–∞–∫—Å. —à–≤–∏–¥–∫—ñ—Å—Ç—å</p>
                                </div>
                                <div class="stat-card">
                                    <h4 id="avgSpeed">0</h4>
                                    <p>–°–µ—Ä–µ–¥. —à–≤–∏–¥–∫—ñ—Å—Ç—å</p>
                                </div>
                                <div class="stat-card">
                                    <h4 id="totalDistance">0</h4>
                                    <p>–ó–∞–≥–∞–ª—å–Ω–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å</p>
                                </div>
                                <div class="stat-card">
                                    <h4 id="onlineTime">00:00</h4>
                                    <p>–ß–∞—Å —Ä–æ–±–æ—Ç–∏</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="panel-section">
                            <h3><i class="fas fa-pie-chart"></i>–†–æ–∑–ø–æ–¥—ñ–ª –ø–æ —Ç–∏–ø–∞–º</h3>
                            <canvas id="targetTypesChart" width="300" height="150"></canvas>
                        </div>
                        
                        <div class="panel-section">
                            <h3><i class="fas fa-layer-group"></i>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≥—Ä—É–ø–∞—Ö</h3>
                            <div id="groupStats" class="stats-grid">
                                <!-- –î–∏–Ω–∞–º—ñ—á–Ω–æ –∑–∞–ø–æ–≤–Ω—é—î—Ç—å—Å—è -->
                            </div>
                        </div>
                    </div>

                    <!-- –í–∫–ª–∞–¥–∫–∞ "–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è" -->
                    <div id="settings-tab" class="tab-content">
                        <div class="panel-section">
                            <h3><i class="fas fa-display"></i>–í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è</h3>
                            <button class="btn btn-small" onclick="toggleClustering()" id="toggleClusterBtn">
                                <i class="fas fa-object-group"></i>–ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü—ñ—è: –£–≤—ñ–º–∫–Ω–µ–Ω–∞
                            </button>
                            <button class="btn btn-small" onclick="toggleArrowMode()" id="toggleArrowBtn">
                                <i class="fas fa-draw-polygon"></i>–†–µ–∂–∏–º —Å—Ç—Ä—ñ–ª–æ–∫
                            </button>
                            <button class="btn btn-small" onclick="toggleTimestamps()">
                                <i class="fas fa-clock"></i>–ß–∞—Å–æ–≤—ñ –º—ñ—Ç–∫–∏
                            </button>
                            <button class="btn btn-small" onclick="toggleGrid()">
                                <i class="fas fa-border-all"></i>–°—ñ—Ç–∫–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
                            </button>
                        </div>
                        
                        <div class="panel-section">
                            <h3><i class="fas fa-tachometer-alt"></i>–ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å</h3>
                            <div class="form-group">
                                <label for="updateInterval">–Ü–Ω—Ç–µ—Ä–≤–∞–ª –æ–Ω–æ–≤–ª–µ–Ω–Ω—è (–º—Å):</label>
                                <input type="range" id="updateInterval" min="50" max="1000" step="50" value="100" class="range-input">
                                <span id="intervalValue">100ms</span>
                            </div>
                            <div class="form-group">
                                <label for="maxTrajectoryPoints">–ú–∞–∫—Å. —Ç–æ—á–æ–∫ —Ç—Ä–∞—î–∫—Ç–æ—Ä—ñ—ó:</label>
                                <input type="range" id="maxTrajectoryPoints" min="10" max="200" step="10" value="50" class="range-input">
                                <span id="maxPointsValue">50 —Ç–æ—á–æ–∫</span>
                            </div>
                            <button class="btn btn-small" onclick="togglePerformanceMode()">
                                <i class="fas fa-bolt"></i>–†–µ–∂–∏–º –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
                            </button>
                        </div>
                        
                        <div class="panel-section">
                            <h3><i class="fas fa-database"></i>–î–∞–Ω—ñ</h3>
                            <button class="btn btn-secondary btn-small" onclick="exportTargets()">
                                <i class="fas fa-download"></i>–ï–∫—Å–ø–æ—Ä—Ç JSON
                            </button>
                            <button class="btn btn-secondary btn-small" onclick="exportCSV()">
                                <i class="fas fa-file-csv"></i>–ï–∫—Å–ø–æ—Ä—Ç CSV
                            </button>
                            <button class="btn btn-secondary btn-small" onclick="importTargets()">
                                <i class="fas fa-upload"></i>–Ü–º–ø–æ—Ä—Ç
                            </button>
                            <button class="btn btn-danger btn-small" onclick="clearAllTargets()">
                                <i class="fas fa-trash"></i>–û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ —Ü—ñ–ª—ñ
                            </button>
                            <button class="btn btn-danger btn-small" onclick="clearLocalStorage()">
                                <i class="fas fa-trash-alt"></i>–û—á–∏—Å—Ç–∏—Ç–∏ —Å—Ö–æ–≤–∏—â–µ
                            </button>
                        </div>
                        
                        <div class="panel-section">
                            <h3><i class="fas fa-wifi"></i>–ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è</h3>
                            <button class="btn btn-small" onclick="checkConnection()">
                                <i class="fas fa-wifi"></i>–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
                            </button>
                            <button class="btn btn-small" onclick="reconnectFirebase()">
                                <i class="fas fa-sync-alt"></i>–ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç–∏—Å—è
                            </button>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="autoSync" checked> –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="status-bar">
            <div class="status-indicator">
                <div id="statusDot" class="offline-dot"></div>
                <span id="statusText">–û—Ñ–ª–∞–π–Ω</span>
            </div>
            <div id="performanceInfo">FPS: <span id="fpsCounter">60</span></div>
            <div id="onlineUsers">–û–Ω–ª–∞–π–Ω: 0</div>
            <div id="lastUpdate">–û–Ω–æ–≤–ª–µ–Ω–æ: --:--:--</div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ñ –≤—ñ–∫–Ω–∞ -->
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –ª–æ–≥—ñ–Ω—É -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeLoginModal()">&times;</button>
            <h3><i class="fas fa-user-shield"></i>–í—Ö—ñ–¥ –¥–ª—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h3>
            <div class="form-group">
                <label for="loginEmail">Email:</label>
                <input type="email" id="loginEmail" placeholder="–í–≤–µ–¥—ñ—Ç—å email">
            </div>
            <div class="form-group">
                <label for="loginPassword">–ü–∞—Ä–æ–ª—å:</label>
                <input type="password" id="loginPassword" placeholder="–í–≤–µ–¥—ñ—Ç—å –ø–∞—Ä–æ–ª—å">
            </div>
            <div class="modal-buttons">
                <button onclick="attemptLogin()" class="btn">–£–≤—ñ–π—Ç–∏</button>
                <button onclick="closeLoginModal()" class="btn btn-danger">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeEditModal()">&times;</button>
            <h3><i class="fas fa-edit"></i>–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ —Ü—ñ–ª—å</h3>
            <div class="form-row">
                <div class="form-group">
                    <label for="editName">–ù–∞–∑–≤–∞ —Ü—ñ–ª—ñ:</label>
                    <input type="text" id="editName">
                </div>
                <div class="form-group">
                    <label for="editType">–¢–∏–ø —Ü—ñ–ª—ñ:</label>
                    <select id="editType">
                        <option value="–¥—Ä–æ–Ω">–î—Ä–æ–Ω</option>
                        <option value="—Ä–∞–∫–µ—Ç–∞">–†–∞–∫–µ—Ç–∞</option>
                        <option value="–≤–∏–Ω–∏—â—É–≤–∞—á">–í–∏–Ω–∏—â—É–≤–∞—á</option>
                        <option value="–±–æ–º–±–∞">–ë–æ–º–±–∞</option>
                        <option value="–∫–æ—Ä–∞–±–ª—å">–ö–æ—Ä–∞–±–µ–ª—å</option>
                        <option value="–≤–µ—Ä—Ç–æ–ª—ñ—Ç">–í–µ—Ä—Ç–æ–ª—ñ—Ç</option>
                        <option value="–ø—É—Å–∫–æ–≤–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∞">–ü—É—Å–∫–æ–≤–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∞</option>
                        <option value="–≥—Ä—É–ø–∞ –±–ø–ª–∞">–ì—Ä—É–ø–∞ –ë–ø–õ–ê</option>
                        <option value="—Ä–æ–∑–≤—ñ–¥–Ω–∏–∫">–†–æ–∑–≤—ñ–¥–Ω–∏–∫</option>
                        <option value="–Ω–µ–≤—ñ–¥–æ–º–∞ —Ü—ñ–ª—å">–ù–µ–≤—ñ–¥–æ–º–∞ —Ü—ñ–ª—å</option>
                        <option value="–±–∞–ª—ñ—Å—Ç–∏—á–Ω–∞ —Ä–∞–∫–µ—Ç–∞">–ë–∞–ª—ñ—Å—Ç–∏—á–Ω–∞ —Ä–∞–∫–µ—Ç–∞</option>
                        <option value="–∫—Ä–∏–ª–∞—Ç–∞ —Ä–∞–∫–µ—Ç–∞">–ö—Ä–∏–ª–∞—Ç–∞ —Ä–∞–∫–µ—Ç–∞</option>
                    </select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="editSpeed">–®–≤–∏–¥–∫—ñ—Å—Ç—å (–∫–º/–≥–æ–¥):</label>
                    <input type="number" id="editSpeed">
                </div>
                <div class="form-group">
                    <label for="editCourse">–ö—É—Ä—Å (0-360¬∞):</label>
                    <input type="number" id="editCourse" min="0" max="360">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="editGroup">–ì—Ä—É–ø–∞:</label>
                    <select id="editGroup">
                        <option value="default">–û—Å–Ω–æ–≤–Ω–∞</option>
                        <option value="air">–ü–æ–≤—ñ—Ç—Ä—è–Ω—ñ</option>
                        <option value="ground">–ù–∞–∑–µ–º–Ω—ñ</option>
                        <option value="naval">–ú–æ—Ä—Å—å–∫—ñ</option>
                        <option value="custom">–ö–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–∞</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editColor">–ö–æ–ª—ñ—Ä —Ç—Ä–∞—î–∫—Ç–æ—Ä—ñ—ó:</label>
                    <input type="color" id="editColor" class="color-picker">
                </div>
            </div>
            <div class="modal-buttons">
                <button onclick="saveTargetEdit()" class="btn">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
                <button onclick="closeEditModal()" class="btn btn-danger">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –≤–∏–±–æ—Ä—É –∫—É—Ä—Å—É -->
    <div id="courseSelectionModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="cancelCourseSelection()">&times;</button>
            <h3><i class="fas fa-route"></i>–í–∏–±—ñ—Ä –∫—É—Ä—Å—É</h3>
            <p>–ö–ª–∞—Ü–Ω—ñ—Ç—å –ø–æ –∫–∞—Ä—Ç—ñ, —â–æ–± –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –Ω–∞–ø—Ä—è–º–æ–∫ —Ä—É—Ö—É —Ü—ñ–ª—ñ</p>
            <div class="modal-buttons">
                <button onclick="confirmCourseSelection()" class="btn">–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏</button>
                <button onclick="cancelCourseSelection()" class="btn btn-danger">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
            </div>
        </div>
    </div>

    <input type="file" id="importFile" style="display: none;" accept=".json,.csv">

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let map;
        let targets = [];
        let markers = {};
        let polylines = {};
        let targetHistory = {};
        let showTrajectories = true;
        let isPanelExpanded = true;
        let isCourseSelectionMode = false;
        let selectedTargetForCourse = null;
        let autoSaveInterval = null;
        let isAdmin = false;
        let currentEditTargetId = null;
        let saveTimeout = null;
        let lastUpdateTime = Date.now();
        let animationFrameId = null;
        let isAddTargetMode = false;
        let popupOpenTargetId = null;
        let deletedTargets = new Set();
        let markerCluster;
        let lastStatsUpdate = Date.now();
        let pausedTargets = new Set();
        let isOnline = false;
        let isSyncing = false;
        let lastSyncTime = Date.now();
        let syncInterval = null;
        let userSessionId = Math.random().toString(36).substring(2, 11);
        let lastSyncTargets = '';
        let lastSyncDeleted = '';
        let locallyModifiedTargets = new Set();
        let modificationTimeouts = {};

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –ø–æ–∏—Å–∫–∞
        let searchMarker = null;
        let searchResults = [];
        let searchTimeout = null;

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ —Å—Ç—Ä–µ–ª–æ–∫ –∏ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏
        let isClusteringEnabled = true;
        let arrowMode = false;
        let tempArrowLine = null;
        let tempArrowStartLatLng = null;
        let allArrows = L.layerGroup();
        let individualTargets = L.layerGroup();

        // –¢–µ–∫—É—â–∏–π —Å—Ç–∏–ª—å –∫–∞—Ä—Ç—ã
        let currentMapStyle = 'dark';

        // –°–ª–æ–∏ –∫–∞—Ä—Ç—ã
        let baseLayers = {
            'dark': null,
            'standard': null,
            'satellite': null
        };

        // –ù–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
        let currentTab = 'targets';
        let currentMovementPattern = 'linear';
        let trajectorySettings = {
            opacity: 0.7,
            width: 3,
            length: 20,
            animationSpeed: 1.0
        };
        let performanceMode = false;
        let showTimestamps = false;
        let showGrid = false;
        let updateInterval = 100;
        let maxTrajectoryPoints = 50;
        let startTime = Date.now();
        let frameCount = 0;
        let lastFPSUpdate = Date.now();
        let currentFPS = 60;
        let targetChart = null;

        // –ì—Ä—É–ø–ø—ã —Ü–µ–ª–µ–π
        const targetGroups = {
            'default': { name: '–û—Å–Ω–æ–≤–Ω–∞', color: '#00cec9' },
            'air': { name: '–ü–æ–≤—ñ—Ç—Ä—è–Ω—ñ', color: '#0984e3' },
            'ground': { name: '–ù–∞–∑–µ–º–Ω—ñ', color: '#27ae60' },
            'naval': { name: '–ú–æ—Ä—Å—å–∫—ñ', color: '#2980b9' },
            'custom': { name: '–ö–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–∞', color: '#9b59b6' }
        };

        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–∫–æ–Ω–æ–∫ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ç–∏–ª–µ–π –∫–∞—Ä—Ç—ã (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è)
        const iconConfig = {
            'dark': {
                '–¥—Ä–æ–Ω': "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMTgiIGZpbGw9IiNmZjAwMDAiLz4KPHN2ZyB4PSIxMCIgeT0iMTAiIHdpZHRoPSIyMCIgaGVpZ2h0PSIyMCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJ3aGl0ZSI+CjxwYXRoIGQ9Ik0xMiAxLjVMMTYuNSA2SDE5LjVMMjIuNSA5VjEwLjVIMjBWMTRINFYxMC41SDEuNVY5TDQuNSA2SDcuNUwxMiAxLjVaIi8+CjwvZz4KPC9zdmc+",
                '—Ä–∞–∫–µ—Ç–∞': "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMTgiIGZpbGw9IiNlNzRjM2MiLz4KPHN2ZyB4PSIxMCIgeT0iMTAiIHdpZHRoPSIyMCIgaGVpZ2h0PSIyMCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJ3aGl0ZSI+CjxwYXRoIGQ9Ik0xMiAyTDE2IDZWMTBIMTNWMTZIMTFWMTBIOFY2TDEyIDJaIi8+CjwvZz4KPC9zdmc+",
                '–≤–∏–Ω–∏—â—É–≤–∞—á': "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMTgiIGZpbGw9IiNmMzljMTIiLz4KPHN2ZyB4PSIxMCIgeT0iMTAiIHdpZHRoPSIyMCIgaGVpZ2h0PSIyMCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJ3aGl0ZSI+CjxwYXRoIGQ9Ik0yIDEyTDEwIDhWNEwxMiAyTDE0IDRWOEwyMiAxMlYxNEgyMFYyMEgxNlYxOEg4VjIwSDRWMTRIMloiLz4KPC9nPgo8L3N2Zz4=",
                '–±–∞–ª—ñ—Å—Ç–∏—á–Ω–∞ —Ä–∞–∫–µ—Ç–∞': "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMTgiIGZpbGw9IiNkNjMwMzEiLz4KPHN2ZyB4PSIxMCIgeT0iMTAiIHdpZHRoPSIyMCIgaGVpZ2h0PSIyMCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJ3aGl0ZSI+CjxwYXRoIGQ9Ik0xMiAxTDE0IDNWNkgxNkwyMCAxMFYxNEgxNlYyMEgxNFYxNkgxMFYxNEg4VjEwTDEyIDZWM0wxMiAxWiIvPgo8L2c+Cjwvc3ZnPg=="
            },
            'standard': {
                '–¥—Ä–æ–Ω': "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMTgiIGZpbGw9IiNmZjAwMDAiIHN0cm9rZT0id2hpdGUiIHN0cm9rZS13aWR0aD0iMiIvPgo8c3ZnIHg9IjEwIiB5PSIxMCIgd2lkdGg9IjIwIiBoZWlnaHQ9IjIwIiB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9IndoaXRlIj4KPHBhdGggZD0iTTEyIDEuNUwxNi41IDZIMTkuNUwyMi41IDlWMTAuNUgyMFYxNEg0VjEwLjVIMS41VjlMNC41IDZINy41TDEyIDEuNVoiLz4KPC9nPgo8L3N2Zz4=",
                '—Ä–∞–∫–µ—Ç–∞': "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMTgiIGZpbGw9IiNlNzRjM2MiIHN0cm9rZT0id2hpdGUiIHN0cm9rZS13aWR0aD0iMiIvPgo8c3ZnIHg9IjEwIiB5PSIxMCIgd2lkdGg9IjIwIiBoZWlnaHQ9IjIwIiB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9IndoaXRlIj4KPHBhdGggZD0iTTEyIDJMMTYgNlYxMEgxM1YxNkgxMVYxMEg4VjZMMTIgMloiLz4KPC9nPgo8L3N2Zz4=",
                '–≤–∏–Ω–∏—â—É–≤–∞—á': "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMTgiIGZpbGw9IiNmMzljMTIiIHN0cm9rZT0id2hpdGUiIHN0cm9rZS13aWR0aD0iMiIvPgo8c3ZnIHg9IjEwIiB5PSIxMCIgd2lkdGg9IjIwIiBoZWlnaHQ9IjIwIiB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9IndoaXRlIj4KPHBhdGggZD0iTTIgMTJMMTAgOFY0TDEyIDJMMTQgNFY4TDIyIDEyVjE0SDIwVjIwSDE2VjE4SDhWMjBINFYxNEgyWiIvPgo8L2c+Cjwvc3ZnPg==",
                '–±–∞–ª—ñ—Å—Ç–∏—á–Ω–∞ —Ä–∞–∫–µ—Ç–∞': "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMTgiIGZpbGw9IiNkNjMwMzEiIHN0cm9rZT0id2hpdGUiIHN0cm9rZS13aWR0aD0iMiIvPgo8c3ZnIHg9IjEwIiB5PSIxMCIgd2lkdGg9IjIwIiBoZWlnaHQ9IjIwIiB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9IndoaXRlIj4KPHBhdGggZD0iTTEyIDFMMTQgM1Y2SDE2TDIwIDEwVjE0SDE2VjIwSDE0VjE2SDEwVjE0SDhWMTBMMTIgNlYzTDEyIDFaIi8+CjwvZz4KPC9zdmc+"
            },
            'satellite': {
                '–¥—Ä–æ–Ω': "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMTgiIGZpbGw9IiNmZjAwMDAiIHN0cm9rZT0iYmxhY2siIHN0cm9rZS13aWR0aD0iMyIvPgo8c3ZnIHg9IjEwIiB5PSIxMCIgd2lkdGg9IjIwIiBoZWlnaHQ9IjIwIiB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9IndoaXRlIj4KPHBhdGggZD0iTTEyIDEuNUwxNi41IDZIMTkuNUwyMi41IDlWMTAuNUgyMFYxNEg0VjEwLjVIMS41VjlMNC41IDZINy41TDEyIDEuNVoiLz4KPC9nPgo8L3N2Zz4=",
                '—Ä–∞–∫–µ—Ç–∞': "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMTgiIGZpbGw9IiNlNzRjM2MiIHN0cm9rZT0iYmxhY2siIHN0cm9rZS13aWR0aD0iMyIvPgo8c3ZnIHg9IjEwIiB5PSIxMCIgd2lkdGg9IjIwIiBoZWlnaHQ9IjIwIiB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9IndoaXRlIj4KPHBhdGggZD0iTTEyIDJMMTYgNlYxMEgxM1YxNkgxMVYxMEg4VjZMMTIgMloiLz4KPC9nPgo8L3N2Zz4=",
                '–≤–∏–Ω–∏—â—É–≤–∞—á': "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMTgiIGZpbGw9IiNmMzljMTIiIHN0cm9rZT0iYmxhY2siIHN0cm9rZS13aWR0aD0iMyIvPgo8c3ZnIHg9IjEwIiB5PSIxMCIgd2lkdGg9IjIwIiBoZWlnaHQ9IjIwIiB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9IndoaXRlIj4KPHBhdGggZD0iTTIgMTJMMTAgOFY0TDEyIDJMMTQgNFY4TDIyIDEyVjE0SDIwVjIwSDE2VjE4SDhWMjBINFYxNEgyWiIvPgo8L2c+Cjwvc3ZnPg==",
                '–±–∞–ª—ñ—Å—Ç–∏—á–Ω–∞ —Ä–∞–∫–µ—Ç–∞': "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMTgiIGZpbGw9IiNkNjMwMzEiIHN0cm9rZT0iYmxhY2siIHN0cm9rZS13aWR0aD0iMyIvPgo8c3ZnIHg9IjEwIiB5PSIxMCIgd2lkdGg9IjIwIiBoZWlnaHQ9IjIwIiB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9IndoaXRlIj4KPHBhdGggZD0iTTEyIDFMMTQgM1Y2SDE2TDIwIDEwVjE0SDE2VjIwSDE0VjE2SDEwVjE0SDhWMTBMMTIgNlYzTDEyIDFaIi8+CjwvZz4KPC9zdmc+"
            }
        };

        // Fallback –∏–∫–æ–Ω–∫–∏ –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Ç–∏–ø–æ–≤
        const fallbackIcons = {
            '–±–æ–º–±–∞': { color: '#e17055', icon: 'fas fa-bomb' },
            '–∫–æ—Ä–∞–±–ª—å': { color: '#0984e3', icon: 'fas fa-ship' },
            '–≤–µ—Ä—Ç–æ–ª—ñ—Ç': { color: '#00b894', icon: 'fas fa-helicopter' },
            '–ø—É—Å–∫–æ–≤–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∞': { color: '#6c5ce7', icon: 'fas fa-rocket' },
            '–≥—Ä—É–ø–∞ –±–ø–ª–∞': { color: '#fd79a8', icon: 'fas fa-cubes' },
            '—Ä–æ–∑–≤—ñ–¥–Ω–∏–∫': { color: '#fdcb6e', icon: 'fas fa-search' },
            '–Ω–µ–≤—ñ–¥–æ–º–∞ —Ü—ñ–ª—å': { color: '#636e72', icon: 'fas fa-question' },
            '–∫—Ä–∏–ª–∞—Ç–∞ —Ä–∞–∫–µ—Ç–∞': { color: '#e84393', icon: 'fas fa-space-shuttle' }
        };

        // –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≤—Å–µ—Ö –Ω–∞—Å–µ–ª–µ–Ω–Ω—ã—Ö –ø—É–Ω–∫—Ç–æ–≤ –£–∫—Ä–∞–∏–Ω—ã (—Å–æ–∫—Ä–∞—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
        const ukraineCities = [
            // –û–±–ª–∞—Å—Ç–Ω—ã–µ —Ü–µ–Ω—Ç—Ä—ã
            { name: "–ö–∏—ó–≤", lat: 50.4501, lng: 30.5234, type: "—Å—Ç–æ–ª–∏—Ü—è" },
            { name: "–•–∞—Ä–∫—ñ–≤", lat: 49.9935, lng: 36.2304, type: "–æ–±–ª–∞—Å–Ω–∏–π —Ü–µ–Ω—Ç—Ä" },
            { name: "–û–¥–µ—Å–∞", lat: 46.4825, lng: 30.7233, type: "–æ–±–ª–∞—Å–Ω–∏–π —Ü–µ–Ω—Ç—Ä" },
            { name: "–î–Ω—ñ–ø—Ä–æ", lat: 48.4647, lng: 35.0462, type: "–æ–±–ª–∞—Å–Ω–∏–π —Ü–µ–Ω—Ç—Ä" },
            { name: "–î–æ–Ω–µ—Ü—å–∫", lat: 48.0159, lng: 37.8029, type: "–æ–±–ª–∞—Å–Ω–∏–π —Ü–µ–Ω—Ç—Ä" },
            { name: "–ó–∞–ø–æ—Ä—ñ–∂–∂—è", lat: 47.8388, lng: 35.1396, type: "–æ–±–ª–∞—Å–Ω–∏–π —Ü–µ–Ω—Ç—Ä" },
            { name: "–õ—å–≤—ñ–≤", lat: 49.8397, lng: 24.0297, type: "–æ–±–ª–∞—Å–Ω–∏–π —Ü–µ–Ω—Ç—Ä" },
            { name: "–ö—Ä–∏–≤–∏–π –†—ñ–≥", lat: 47.9105, lng: 33.3918, type: "–º—ñ—Å—Ç–æ" },
            { name: "–ú–∏–∫–æ–ª–∞—ó–≤", lat: 46.9750, lng: 31.9946, type: "–æ–±–ª–∞—Å–Ω–∏–π —Ü–µ–Ω—Ç—Ä" },
            { name: "–ú–∞—Ä—ñ—É–ø–æ–ª—å", lat: 47.0971, lng: 37.5434, type: "–º—ñ—Å—Ç–æ" },
            { name: "–õ—É–≥–∞–Ω—Å—å–∫", lat: 48.5740, lng: 39.3078, type: "–æ–±–ª–∞—Å–Ω–∏–π —Ü–µ–Ω—Ç—Ä" },
            { name: "–í—ñ–Ω–Ω–∏—Ü—è", lat: 49.2331, lng: 28.4682, type: "–æ–±–ª–∞—Å–Ω–∏–π —Ü–µ–Ω—Ç—Ä" },
            { name: "–•–µ—Ä—Å–æ–Ω", lat: 46.6354, lng: 32.6169, type: "–æ–±–ª–∞—Å–Ω–∏–π —Ü–µ–Ω—Ç—Ä" },
            { name: "–ü–æ–ª—Ç–∞–≤–∞", lat: 49.5883, lng: 34.5514, type: "–æ–±–ª–∞—Å–Ω–∏–π —Ü–µ–Ω—Ç—Ä" },
            { name: "–ß–µ—Ä–Ω—ñ–≥—ñ–≤", lat: 51.4982, lng: 31.2893, type: "–æ–±–ª–∞—Å–Ω–∏–π —Ü–µ–Ω—Ç—Ä" },
            { name: "–ß–µ—Ä–∫–∞—Å–∏", lat: 49.4444, lng: 32.0598, type: "–æ–±–ª–∞—Å–Ω–∏–π —Ü–µ–Ω—Ç—Ä" },
            { name: "–ñ–∏—Ç–æ–º–∏—Ä", lat: 50.2547, lng: 28.6587, type: "–æ–±–ª–∞—Å–Ω–∏–π —Ü–µ–Ω—Ç—Ä" },
            { name: "–°—É–º–∏", lat: 50.9077, lng: 34.7981, type: "–æ–±–ª–∞—Å–Ω–∏–π —Ü–µ–Ω—Ç—Ä" },
            { name: "–•–º–µ–ª—å–Ω–∏—Ü—å–∫–∏–π", lat: 49.4229, lng: 26.9871, type: "–æ–±–ª–∞—Å–Ω–∏–π —Ü–µ–Ω—Ç—Ä" },
            { name: "–ß–µ—Ä–Ω—ñ–≤—Ü—ñ", lat: 48.2917, lng: 25.9352, type: "–æ–±–ª–∞—Å–Ω–∏–π —Ü–µ–Ω—Ç—Ä" },
            { name: "–†—ñ–≤–Ω–µ", lat: 50.6199, lng: 26.2516, type: "–æ–±–ª–∞—Å–Ω–∏–π —Ü–µ–Ω—Ç—Ä" },
            { name: "–Ü–≤–∞–Ω–æ-–§—Ä–∞–Ω–∫—ñ–≤—Å—å–∫", lat: 48.9226, lng: 24.7111, type: "–æ–±–ª–∞—Å–Ω–∏–π —Ü–µ–Ω—Ç—Ä" },
            { name: "–¢–µ—Ä–Ω–æ–ø—ñ–ª—å", lat: 49.5535, lng: 25.5948, type: "–æ–±–ª–∞—Å–Ω–∏–π —Ü–µ–Ω—Ç—Ä" },
            { name: "–õ—É—Ü—å–∫", lat: 50.7472, lng: 25.3254, type: "–æ–±–ª–∞—Å–Ω–∏–π —Ü–µ–Ω—Ç—Ä" },
            { name: "–£–∂–≥–æ—Ä–æ–¥", lat: 48.6208, lng: 22.2879, type: "–æ–±–ª–∞—Å–Ω–∏–π —Ü–µ–Ω—Ç—Ä" },
            // –ö—Ä—É–ø–Ω—ã–µ –≥–æ—Ä–æ–¥–∞
            { name: "–ë—ñ–ª–∞ –¶–µ—Ä–∫–≤–∞", lat: 49.7956, lng: 30.1167, type: "–º—ñ—Å—Ç–æ" },
            { name: "–ö—Ä–∞–º–∞—Ç–æ—Ä—Å—å–∫", lat: 48.7382, lng: 37.5842, type: "–º—ñ—Å—Ç–æ" },
            { name: "–ú–µ–ª—ñ—Ç–æ–ø–æ–ª—å", lat: 46.8480, lng: 35.3653, type: "–º—ñ—Å—Ç–æ" },
            { name: "–°–ª–æ–≤'—è–Ω—Å—å–∫", lat: 48.8534, lng: 37.6053, type: "–º—ñ—Å—Ç–æ" },
            { name: "–ë–µ—Ä–¥—è–Ω—Å—å–∫", lat: 46.7590, lng: 36.7884, type: "–º—ñ—Å—Ç–æ" },
            { name: "–ù—ñ–∫–æ–ø–æ–ª—å", lat: 47.5672, lng: 34.3949, type: "–º—ñ—Å—Ç–æ" },
            { name: "–ü–∞–≤–ª–æ–≥—Ä–∞–¥", lat: 48.5204, lng: 35.8706, type: "–º—ñ—Å—Ç–æ" },
            { name: "–£–º–∞–Ω—å", lat: 48.7500, lng: 30.2167, type: "–º—ñ—Å—Ç–æ" },
            { name: "–ë—Ä–æ–≤–∞—Ä–∏", lat: 50.5113, lng: 30.7905, type: "–º—ñ—Å—Ç–æ" },
            { name: "–ú—É–∫–∞—á–µ–≤–æ", lat: 48.4415, lng: 22.7136, type: "–º—ñ—Å—Ç–æ" },
            { name: "–ë–∞—Ö–º—É—Ç", lat: 48.5956, lng: 38.0000, type: "–º—ñ—Å—Ç–æ" },
            { name: "–ê–≤–¥—ñ—ó–≤–∫–∞", lat: 48.1333, lng: 37.7500, type: "–º—ñ—Å—Ç–æ" },
            { name: "–ü–æ–∫—Ä–æ–≤—Å—å–∫", lat: 48.2833, lng: 37.1833, type: "–º—ñ—Å—Ç–æ" },
            { name: "–ö—É–ø'—è–Ω—Å—å–∫", lat: 49.7167, lng: 37.6167, type: "–º—ñ—Å—Ç–æ" },
            { name: "–õ–∏–º–∞–Ω", lat: 48.9833, lng: 37.8167, type: "–º—ñ—Å—Ç–æ" },
            { name: "–ë–∞–ª–∞–∫–ª—ñ—è", lat: 49.4667, lng: 36.8667, type: "–º—ñ—Å—Ç–æ" },
            { name: "–Ü–∑—é–º", lat: 49.2167, lng: 37.2833, type: "–º—ñ—Å—Ç–æ" },
            // –†–æ—Å—ñ–π—Å—å–∫—ñ –º—ñ—Å—Ç–∞ –±—ñ–ª—è –∫–æ—Ä–¥–æ–Ω—É
            { name: "–†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É", lat: 47.2221, lng: 39.7203, type: "—Ä–æ—Å—ñ–π—Å—å–∫–µ –º—ñ—Å—Ç–æ" },
            { name: "–ë–µ–ª–≥–æ—Ä–æ–¥", lat: 50.5955, lng: 36.5873, type: "—Ä–æ—Å—ñ–π—Å—å–∫–µ –º—ñ—Å—Ç–æ" },
            { name: "–ö—É—Ä—Å–∫", lat: 51.7304, lng: 36.1926, type: "—Ä–æ—Å—ñ–π—Å—å–∫–µ –º—ñ—Å—Ç–æ" },
            { name: "–í–æ—Ä–æ–Ω–µ–∂", lat: 51.6720, lng: 39.1843, type: "—Ä–æ—Å—ñ–π—Å—å–∫–µ –º—ñ—Å—Ç–æ" },
            { name: "–ë—Ä—è–Ω—Å–∫", lat: 53.2436, lng: 34.3634, type: "—Ä–æ—Å—ñ–π—Å—å–∫–µ –º—ñ—Å—Ç–æ" }
        ];

        // –í–ê–®–Ü –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø FIREBASE
        const firebaseConfig = {
            apiKey: "AIzaSyCXB-klfdlwFb8QzbeqolqSghBpPrmFwio",
            authDomain: "air-tracking-site.firebaseapp.com",
            databaseURL: "https://air-tracking-site-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "air-tracking-site",
            storageBucket: "air-tracking-site.firebasestorage.app",
            messagingSenderId: "185790784262",
            appId: "1:185790784262:web:bc28d6942b6d9792b8b487",
            measurementId: "G-XW9Y6JKCPG"
        };

        // –¢–∏–ø—ã —Ü–µ–ª–µ–π —Å –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏
        const targetTypes = {
            '–¥—Ä–æ–Ω': { name: "–î—Ä–æ–Ω" },
            '—Ä–∞–∫–µ—Ç–∞': { name: "–†–∞–∫–µ—Ç–∞" },
            '–≤–∏–Ω–∏—â—É–≤–∞—á': { name: "–í–∏–Ω–∏—â—É–≤–∞—á" },
            '–±–æ–º–±–∞': { name: "–ë–æ–º–±–∞" },
            '–∫–æ—Ä–∞–±–ª—å': { name: "–ö–æ—Ä–∞–±–µ–ª—å" },
            '–≤–µ—Ä—Ç–æ–ª—ñ—Ç': { name: "–í–µ—Ä—Ç–æ–ª—ñ—Ç" },
            '–ø—É—Å–∫–æ–≤–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∞': { name: "–ü—É—Å–∫–æ–≤–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∞" },
            '–≥—Ä—É–ø–∞ –±–ø–ª–∞': { name: "–ì—Ä—É–ø–∞ –ë–ø–õ–ê" },
            '—Ä–æ–∑–≤—ñ–¥–Ω–∏–∫': { name: "–†–æ–∑–≤—ñ–¥–Ω–∏–∫" },
            '–Ω–µ–≤—ñ–¥–æ–º–∞ —Ü—ñ–ª—å': { name: "–ù–µ–≤—ñ–¥–æ–º–∞ —Ü—ñ–ª—å" },
            '–±–∞–ª—ñ—Å—Ç–∏—á–Ω–∞ —Ä–∞–∫–µ—Ç–∞': { name: "–ë–∞–ª—ñ—Å—Ç–∏—á–Ω–∞ —Ä–∞–∫–µ—Ç–∞" },
            '–∫—Ä–∏–ª–∞—Ç–∞ —Ä–∞–∫–µ—Ç–∞': { name: "–ö—Ä–∏–ª–∞—Ç–∞ —Ä–∞–∫–µ—Ç–∞" }
        };

        // =========================
        // –û–°–ù–û–í–ù–Ü –§–£–ù–ö–¶–Ü–á –î–û–î–ê–¢–ö–ê
        // =========================

        // –ó–∞–∫—Ä—ã—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
        function closeWarningModal() {
            document.getElementById('warningModal').style.display = 'none';
            localStorage.setItem('warningShown', 'true');
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        function initApp() {
            console.log("–Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Ä–æ–∑—à–∏—Ä–µ–Ω–æ—ó –≤–µ—Ä—Å—ñ—ó –¥–æ–¥–∞—Ç–∫–∞...");
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫
            if (typeof L === 'undefined') {
                console.error('Leaflet –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏–≤—Å—è');
                alert('–ü–æ–º–∏–ª–∫–∞: –ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ –∫–∞—Ä—Ç –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏–ª–∞—Å—å. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É');
                return;
            }
            
            if (typeof firebase === 'undefined') {
                console.error('Firebase –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏–≤—Å—è');
                alert('–ü–æ–º–∏–ª–∫–∞: Firebase –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏–≤—Å—è. –î–µ—è–∫—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –±—É–¥—É—Ç—å –æ–±–º–µ–∂–µ–Ω—ñ');
            }
            
            try {
                initMap();
                loadTargetsFromLocalStorage();
                initFirebase();
                setupEventListeners();
                updateStats();
                updateStatus();
                startAutoSave();
                updateUIForUserRole();
                initializeRangeSliders();
                startAnimationLoop();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –ø–æ—Å–µ—â–µ–Ω–∏–∏
                if (!localStorage.getItem('warningShown')) {
                    document.getElementById('warningModal').style.display = 'block';
                }
                
                console.log("–î–æ–¥–∞—Ç–æ–∫ —É—Å–ø—ñ—à–Ω–æ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ");
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó:', error);
                alert('–ü–æ–º–∏–ª–∫–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó: ' + error.message);
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã
        function initMap() {
            try {
                const mapElement = document.getElementById('map');
                if (!mapElement) {
                    throw new Error('–ï–ª–µ–º–µ–Ω—Ç –∫–∞—Ä—Ç–∏ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ');
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –ª–∏ –∫–∞—Ä—Ç–∞ —É–∂–µ
                if (map) {
                    map.remove();
                    map = null;
                    markers = {};
                    polylines = {};
                }
                
                // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫–∞—Ä—Ç—ã
                mapElement.innerHTML = '<div class="crosshair"></div><div class="map-switcher"><select id="mapStyleSelector" onchange="changeMapStyle()"><option value="dark">–¢–µ–º–Ω–∞ –∫–∞—Ä—Ç–∞</option><option value="standard">–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞</option><option value="satellite">–°—É–ø—É—Ç–Ω–∏–∫</option></select></div>';
                
                map = L.map('map').setView([50.4500, 30.5233], 6);

                // –ë–∞–∑–æ–≤—ã–µ —Å–ª–æ–∏ –∫–∞—Ä—Ç—ã
                baseLayers.dark = L.tileLayer('https://api.maptiler.com/maps/basic-v2-dark/{z}/{x}/{y}.png?key=FwLDJ8CDh1JptvWufV7a', {
                    attribution: '<a href="https://www.maptiler.com/copyright/" target="_blank">¬© MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">¬© OpenStreetMap contributors</a>',
                    maxZoom: 19,
                    tileSize: 512,
                    zoomOffset: -1
                }).addTo(map);

                baseLayers.standard = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                    maxZoom: 19
                });

                const satelliteBase = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                    attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community',
                    maxZoom: 19
                });

                const satelliteLabels = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                    opacity: 0.6,
                    maxZoom: 19
                });

                baseLayers.satellite = L.layerGroup([satelliteBase, satelliteLabels]);

                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏
                markerCluster = L.markerClusterGroup({
                    chunkedLoading: true,
                    maxClusterRadius: 50,
                    spiderfyOnMaxZoom: true,
                    showCoverageOnHover: false,
                    zoomToBoundsOnClick: true,
                    iconCreateFunction: function(cluster) {
                        const count = cluster.getChildCount();
                        let size = 'small';
                        if (count > 10) size = 'medium';
                        if (count > 25) size = 'large';
                        
                        return L.divIcon({
                            html: '<div><span>' + count + '</span></div>',
                            className: 'marker-cluster marker-cluster-' + size,
                            iconSize: L.point(40, 40)
                        });
                    }
                });
                map.addLayer(markerCluster);
                
                map.addLayer(individualTargets);
                map.addLayer(allArrows);

                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –∫–∞—Ä—Ç—ã
                map.on('click', function(e) {
                    if (isAddTargetMode && isAdmin) {
                        addTargetAtPosition(e.latlng);
                        isAddTargetMode = false;
                    } else if (isCourseSelectionMode && selectedTargetForCourse) {
                        setTargetCourseFromMap(e.latlng);
                    } else if (arrowMode) {
                        handleArrowClick(e);
                    }
                });

                map.on('zoomend', function() {
                    updateTargetClusters();
                });

                map.on('mousemove', function(e) {
                    if (arrowMode && tempArrowStartLatLng && tempArrowLine) {
                        tempArrowLine.setLatLngs([tempArrowStartLatLng, e.latlng]);
                    }
                });

                console.log("–ö–∞—Ä—Ç–∞ —É—Å–ø—ñ—à–Ω–æ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∞");
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –∫–∞—Ä—Ç–∏:', error);
                alert('–ü–æ–º–∏–ª–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–∞—Ä—Ç–∏: ' + error.message);
            }
        }

        // –°–º–µ–Ω–∞ —Å—Ç–∏–ª—è –∫–∞—Ä—Ç—ã
        function changeMapStyle() {
            const style = document.getElementById('mapStyleSelector').value;
            currentMapStyle = style;
            
            // –£–¥–∞–ª—è–µ–º –≤—Å–µ —Ç–µ–∫—É—â–∏–µ –±–∞–∑–æ–≤—ã–µ —Å–ª–æ–∏
            Object.values(baseLayers).forEach(layer => {
                if (layer && map.hasLayer(layer)) {
                    map.removeLayer(layer);
                }
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Å–ª–æ–π
            if (baseLayers[style]) {
                baseLayers[style].addTo(map);
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ –∏–∫–æ–Ω–∫–∏ –º–∞—Ä–∫–µ—Ä–æ–≤ –¥–ª—è –Ω–æ–≤–æ–≥–æ —Å—Ç–∏–ª—è
            updateAllMarkerIcons();
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫ –ø–∞–Ω–µ–ª–∏
        function switchTab(tabName) {
            // –°–∫—Ä—ã—Ç—å –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.panel-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            document.getElementById(tabName + '-tab').classList.add('active');
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            
            currentTab = tabName;
            
            // –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ
            if (tabName === 'statistics') {
                updateAdvancedStats();
            }
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        function setupEventListeners() {
            // –í–∫–ª–∞–¥–∫–∏ –ø–∞–Ω–µ–ª–∏
            document.querySelectorAll('.panel-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    switchTab(this.dataset.tab);
                });
            });
            
            // –ü–æ–∏—Å–∫ —Å –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ–º
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', function() {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    performAutoSearch(this.value);
                }, 300);
            });

            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    performSearch();
                }
            });

            // –ò–º–ø–æ—Ä—Ç —Ñ–∞–π–ª–æ–≤
            document.getElementById('importFile').addEventListener('change', handleFileImport);
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –Ω–æ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            document.getElementById('trajectoryOpacity').addEventListener('input', updateTrajectorySettings);
            document.getElementById('trajectoryWidth').addEventListener('input', updateTrajectorySettings);
            document.getElementById('trajectoryLength').addEventListener('input', updateTrajectorySettings);
            document.getElementById('animationSpeed').addEventListener('input', updateTrajectorySettings);
            document.getElementById('updateInterval').addEventListener('input', updatePerformanceSettings);
            document.getElementById('maxTrajectoryPoints').addEventListener('input', updatePerformanceSettings);
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–∫–æ–Ω–∫–∏ –¥–ª—è —Ç–∏–ø–∞ —Ü–µ–ª–∏
        function getIconForType(type, course = 0) {
            const iconUrl = iconConfig[currentMapStyle] && iconConfig[currentMapStyle][type];
            
            if (iconUrl) {
                return L.divIcon({
                    html: `<div class="rotatable-png-icon" style="transform: rotate(${course + 90}deg); 
                           background-image: url('${iconUrl}')"></div>`,
                    className: 'png-icon-marker',
                    iconSize: [40, 40],
                    iconAnchor: [20, 20]
                });
            }
            
            // Fallback –∏–∫–æ–Ω–∫–∞
            return createFallbackIcon(type, course);
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ fallback –∏–∫–æ–Ω–∫–∏
        function createFallbackIcon(type, course = 0) {
            const fallback = fallbackIcons[type] || { color: '#636e72', icon: 'fas fa-question' };
            
            return L.divIcon({
                html: `<div style="
                    width: 40px; 
                    height: 40px; 
                    background: ${fallback.color}; 
                    border-radius: 50%; 
                    display: flex; 
                    align-items: center; 
                    justify-content: center; 
                    transform: rotate(${course + 90}deg);
                    border: 2px solid white;
                    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
                ">
                    <i class="${fallback.icon}" style="color: white; font-size: 16px;"></i>
                </div>`,
                className: 'custom-marker',
                iconSize: [40, 40],
                iconAnchor: [20, 20]
            });
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ü–µ–ª–∏ –Ω–∞ –∫–∞—Ä—Ç—É
        function addTargetToMap(target) {
            if (markers[target.id]) {
                if (isClusteringEnabled) {
                    markerCluster.removeLayer(markers[target.id]);
                } else {
                    individualTargets.removeLayer(markers[target.id]);
                }
            }
            
            const icon = getIconForType(target.type, target.course);
            const marker = L.marker([target.latitude, target.longitude], { icon: icon });
            
            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É —Å–æ–∑–¥–∞–Ω–∏—è
            const createdDate = new Date(target.createdAt);
            const formattedDate = createdDate.toLocaleString('uk-UA');
            
            // –°–æ–∑–¥–∞–µ–º popup —Å —É–ª—É—á—à–µ–Ω–Ω—ã–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º
            const popupContent = `
                <div class="target-info-window">
                    <h4>${target.name}</h4>
                    <p><strong>–¢–∏–ø:</strong> ${targetTypes[target.type]?.name || target.type}</p>
                    <p><strong>–®–≤–∏–¥–∫—ñ—Å—Ç—å:</strong> ${target.speed} –∫–º/–≥–æ–¥</p>
                    <p><strong>–ö—É—Ä—Å:</strong> ${target.course}¬∞</p>
                    <p><strong>–ì—Ä—É–ø–∞:</strong> ${targetGroups[target.group || 'default'].name}</p>
                    <p><strong>–í—ñ–¥—Å—Ç–∞–Ω—å:</strong> ${(target.distance / 1000).toFixed(1)} –∫–º</p>
                    <p><strong>–ü–∞—Ç—Ç–µ—Ä–Ω:</strong> ${target.pattern || '–õ—ñ–Ω—ñ–π–Ω–∏–π'}</p>
                    <p><strong>–î–æ–¥–∞–Ω–æ:</strong> ${formattedDate}</p>
                    ${isAdmin ? `
                    <div class="action-buttons">
                        <button class="action-button edit-btn" onclick="event.stopPropagation(); editTarget('${target.id}')">
                            <i class="fas fa-edit"></i> –†–µ–¥–∞–≥—É–≤–∞—Ç–∏
                        </button>
                        <button class="action-button delete-btn" onclick="event.stopPropagation(); deleteTarget('${target.id}')">
                            <i class="fas fa-trash"></i> –í–∏–¥–∞–ª–∏—Ç–∏
                        </button>
                        <button class="action-button course-btn" onclick="event.stopPropagation(); showCourseSelectionModal('${target.id}')">
                            <i class="fas fa-route"></i> –ö—É—Ä—Å
                        </button>
                    </div>
                    ` : ''}
                </div>
            `;
            
            marker.bindPopup(popupContent);
            
            if (isClusteringEnabled) {
                markerCluster.addLayer(marker);
            } else {
                individualTargets.addLayer(marker);
            }
            
            markers[target.id] = marker;

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ popup
            marker.on('popupopen', function() {
                pausedTargets.add(target.id);
            });
            
            marker.on('popupclose', function() {
                pausedTargets.delete(target.id);
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏—é
            addTrajectory(target);
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏
        function addTrajectory(target) {
            if (!showTrajectories) return;
            
            const color = target.trajectoryColor || target.color || '#ff0000';
            
            if (polylines[target.id]) {
                map.removeLayer(polylines[target.id]);
            }
            
            if (!targetHistory[target.id]) {
                targetHistory[target.id] = [];
            }
            
            if (targetHistory[target.id].length > 1) {
                const polyline = L.polyline(targetHistory[target.id], {
                    color: color,
                    weight: trajectorySettings.width,
                    opacity: trajectorySettings.opacity,
                    smoothFactor: 1
                });
                
                polyline.addTo(map);
                polylines[target.id] = polyline;
                
                // –î–æ–±–∞–≤–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏ –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω—ã
                if (showTimestamps) {
                    addTimestampsToTrajectory(target);
                }
            }
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–µ—Ç–æ–∫ –Ω–∞ —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏—é
        function addTimestampsToTrajectory(target) {
            const history = targetHistory[target.id];
            if (!history || history.length < 2) return;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ –∫–∞–∂–¥—ã–µ 5 —Ç–æ—á–µ–∫
            for (let i = 0; i < history.length; i += 5) {
                const point = history[i];
                if (point.timestamp) {
                    const time = new Date(point.timestamp).toLocaleTimeString('uk-UA', {
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    
                    L.circleMarker([point.lat, point.lng], {
                        radius: 3,
                        color: target.trajectoryColor || '#00cec9',
                        fillOpacity: 0.8
                    }).bindTooltip(time, {
                        permanent: false,
                        direction: 'top'
                    }).addTo(map);
                }
            }
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ü–µ–ª–∏ –≤ —Ü–µ–Ω—Ç—Ä –∫–∞—Ä—Ç—ã
        function addTargetAtCenter() {
            const center = map.getCenter();
            const newTarget = createTarget(
                center.lat,
                center.lng,
                document.getElementById('targetName').value,
                document.getElementById('targetType').value,
                parseInt(document.getElementById('targetSpeed').value),
                parseInt(document.getElementById('targetCourse').value),
                document.getElementById('targetGroup').value,
                document.getElementById('targetColor').value
            );
            
            addTarget(newTarget);
            
            // –ê–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç –Ω–∞–∑–≤–∞–Ω–∏—è
            const nameInput = document.getElementById('targetName');
            const match = nameInput.value.match(/^(.*?)(\d+)$/);
            if (match) {
                const base = match[1];
                const num = parseInt(match[2]) + 1;
                nameInput.value = base + num;
            } else {
                nameInput.value = nameInput.value + '-2';
            }
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ —Ü–µ–ª–∏
        function createTarget(lat, lng, name, type, speed, course, group = 'default', color = '#ff0000') {
            return {
                id: Date.now().toString() + Math.random().toString(36).substr(2, 9),
                name: name || '–¶—ñ–ª—å-' + (targets.length + 1),
                type: type || '–¥—Ä–æ–Ω',
                latitude: lat,
                longitude: lng,
                speed: speed || 150,
                course: course || 0,
                group: group || 'default',
                trajectoryColor: color || '#ff0000',
                createdAt: new Date().toISOString(),
                distance: 0,
                pattern: currentMovementPattern,
                patternData: {}
            };
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ü–µ–ª–∏
        function addTarget(target) {
            targets.push(target);
            targetHistory[target.id] = [{
                lat: target.latitude,
                lng: target.longitude,
                timestamp: Date.now()
            }];
            
            addTargetToMap(target);
            updateTargetsList();
            updateStats();
            saveToLocalStorage();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ü–µ–ª–µ–π
        function updateTargetsList() {
            const targetsList = document.getElementById('targetsList');
            targetsList.innerHTML = '';
            
            // –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Ü–µ–ª–µ–π –ø–æ –≥—Ä—É–ø–ø–∞–º
            const groupedTargets = {};
            targets.forEach(target => {
                const group = target.group || 'default';
                if (!groupedTargets[group]) {
                    groupedTargets[group] = [];
                }
                groupedTargets[group].push(target);
            });
            
            Object.keys(groupedTargets).forEach(groupKey => {
                const groupTargets = groupedTargets[groupKey];
                const groupInfo = targetGroups[groupKey] || { name: groupKey, color: '#636e72' };
                
                // –ó–∞–≥–æ–ª–æ–≤–æ–∫ –≥—Ä—É–ø–ø—ã
                const groupHeader = document.createElement('div');
                groupHeader.style.cssText = `
                    color: ${groupInfo.color};
                    font-weight: bold;
                    margin: 10px 0 5px 0;
                    padding: 5px;
                    background: rgba(52, 73, 94, 0.3);
                    border-radius: 3px;
                    font-size: 12px;
                `;
                groupHeader.textContent = `${groupInfo.name} (${groupTargets.length})`;
                targetsList.appendChild(groupHeader);
                
                groupTargets.forEach(target => {
                    const targetElement = document.createElement('div');
                    targetElement.className = 'target-item';
                    targetElement.style.borderLeftColor = target.trajectoryColor || groupInfo.color;
                    
                    targetElement.innerHTML = `
                        <h4>
                            ${target.name}
                            <span style="font-size: 10px; color: #dfe6e9;">
                                ${targetTypes[target.type]?.name || target.type}
                            </span>
                        </h4>
                        <p>–®–≤–∏–¥–∫—ñ—Å—Ç—å: ${target.speed} –∫–º/–≥–æ–¥ | –ö—É—Ä—Å: ${target.course}¬∞</p>
                        <p>–í—ñ–¥—Å—Ç–∞–Ω—å: ${(target.distance / 1000).toFixed(1)} –∫–º</p>
                        <p>–ü–∞—Ç—Ç–µ—Ä–Ω: ${target.pattern || '–õ—ñ–Ω—ñ–π–Ω–∏–π'}</p>
                        ${isAdmin ? `
                        <div class="target-actions">
                            <button class="btn btn-small" onclick="focusOnTarget('${target.id}')">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-small" onclick="editTarget('${target.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-small btn-danger" onclick="deleteTarget('${target.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                        ` : ''}
                    `;
                    
                    targetsList.appendChild(targetElement);
                });
            });
        }

        // –§–æ–∫—É—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞ —Ü–µ–ª–∏
        function focusOnTarget(targetId) {
            const target = targets.find(t => t.id === targetId);
            if (target && markers[target.id]) {
                map.setView([target.latitude, target.longitude], 12);
                markers[target.id].openPopup();
            }
        }

        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–ª–∏
        function editTarget(targetId) {
            const target = targets.find(t => t.id === targetId);
            if (!target) return;
            
            currentEditTargetId = targetId;
            
            document.getElementById('editName').value = target.name;
            document.getElementById('editType').value = target.type;
            document.getElementById('editSpeed').value = target.speed;
            document.getElementById('editCourse').value = target.course;
            document.getElementById('editGroup').value = target.group || 'default';
            document.getElementById('editColor').value = target.trajectoryColor || '#ff0000';
            
            document.getElementById('editModal').style.display = 'block';
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ü–µ–ª–∏
        function saveTargetEdit() {
            if (!currentEditTargetId) return;
            
            const target = targets.find(t => t.id === currentEditTargetId);
            if (!target) return;
            
            target.name = document.getElementById('editName').value;
            target.type = document.getElementById('editType').value;
            target.speed = parseInt(document.getElementById('editSpeed').value);
            target.course = parseInt(document.getElementById('editCourse').value);
            target.group = document.getElementById('editGroup').value;
            target.trajectoryColor = document.getElementById('editColor').value;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –º–∞—Ä–∫–µ—Ä –Ω–∞ –∫–∞—Ä—Ç–µ
            addTargetToMap(target);
            updateTargetsList();
            updateStats();
            saveToLocalStorage();
            
            closeEditModal();
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
            currentEditTargetId = null;
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ —Ü–µ–ª–∏
        function deleteTarget(targetId) {
            if (!confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü—é —Ü—ñ–ª—å?')) return;
            
            targets = targets.filter(t => t.id !== targetId);
            
            if (markers[targetId]) {
                if (isClusteringEnabled) {
                    markerCluster.removeLayer(markers[targetId]);
                } else {
                    individualTargets.removeLayer(markers[targetId]);
                }
                delete markers[targetId];
            }
            
            if (polylines[targetId]) {
                map.removeLayer(polylines[targetId]);
                delete polylines[targetId];
            }
            
            delete targetHistory[targetId];
            
            updateTargetsList();
            updateStats();
            saveToLocalStorage();
        }

        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞—Ç—Ç–µ—Ä–Ω–∞ –¥–≤–∏–∂–µ–Ω–∏—è
        function setMovementPattern(pattern) {
            currentMovementPattern = pattern;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º UI
            document.querySelectorAll('.pattern-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-pattern="${pattern}"]`).classList.add('active');
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –∫ –≤—ã–±—Ä–∞–Ω–Ω—ã–º —Ü–µ–ª—è–º
            targets.forEach(target => {
                target.pattern = pattern;
                target.patternData = {};
            });
            
            saveToLocalStorage();
        }

        // –î–≤–∏–∂–µ–Ω–∏–µ —Ü–µ–ª–µ–π —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º–∏
        function moveTargets() {
            if (performanceMode && frameCount % 3 !== 0) return;
            
            const now = Date.now();
            const deltaTime = (now - lastUpdateTime) / 1000; // –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
            lastUpdateTime = now;
            
            targets.forEach(target => {
                if (pausedTargets.has(target.id)) return;
                
                const speedMs = (target.speed * 1000) / 3600; // –º/—Å
                const distance = speedMs * deltaTime * trajectorySettings.animationSpeed;
                
                let newLat = target.latitude;
                let newLng = target.longitude;
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω –¥–≤–∏–∂–µ–Ω–∏—è
                switch (target.pattern) {
                    case 'linear':
                        const courseRad = (target.course * Math.PI) / 180;
                        const latOffset = (distance / 111000) * Math.cos(courseRad);
                        const lngOffset = (distance / (111000 * Math.cos(target.latitude * Math.PI / 180))) * Math.sin(courseRad);
                        
                        newLat = target.latitude + latOffset;
                        newLng = target.longitude + lngOffset;
                        break;
                        
                    case 'zigzag':
                        if (!target.patternData.zigzagTime) target.patternData.zigzagTime = 0;
                        target.patternData.zigzagTime += deltaTime;
                        
                        const zigzagOffset = Math.sin(target.patternData.zigzagTime * 2) * 0.001;
                        const baseCourse = (target.course * Math.PI) / 180;
                        
                        newLat = target.latitude + (distance / 111000) * Math.cos(baseCourse) + zigzagOffset;
                        newLng = target.longitude + (distance / (111000 * Math.cos(target.latitude * Math.PI / 180))) * Math.sin(baseCourse);
                        break;
                        
                    case 'spiral':
                        if (!target.patternData.spiralAngle) target.patternData.spiralAngle = 0;
                        if (!target.patternData.spiralRadius) target.patternData.spiralRadius = 0.01;
                        
                        target.patternData.spiralAngle += deltaTime * 0.5;
                        target.patternData.spiralRadius += deltaTime * 0.001;
                        
                        newLat = target.latitude + target.patternData.spiralRadius * Math.cos(target.patternData.spiralAngle);
                        newLng = target.longitude + target.patternData.spiralRadius * Math.sin(target.patternData.spiralAngle);
                        break;
                        
                    case 'circle':
                        if (!target.patternData.circleAngle) target.patternData.circleAngle = 0;
                        if (!target.patternData.circleCenter) {
                            target.patternData.circleCenter = { lat: target.latitude, lng: target.longitude };
                            target.patternData.circleRadius = 0.02;
                        }
                        
                        target.patternData.circleAngle += deltaTime * 0.3;
                        
                        newLat = target.patternData.circleCenter.lat + target.patternData.circleRadius * Math.cos(target.patternData.circleAngle);
                        newLng = target.patternData.circleCenter.lng + target.patternData.circleRadius * Math.sin(target.patternData.circleAngle);
                        break;
                        
                    case 'patrol':
                        if (!target.patternData.patrolDirection) target.patternData.patrolDirection = 1;
                        if (!target.patternData.patrolDistance) target.patternData.patrolDistance = 0;
                        if (!target.patternData.patrolMaxDistance) target.patternData.patrolMaxDistance = 0.05;
                        
                        const patrolCourse = (target.course * Math.PI) / 180;
                        const patrolStep = distance / 111000 * target.patternData.patrolDirection;
                        
                        newLat = target.latitude + patrolStep * Math.cos(patrolCourse);
                        newLng = target.longitude + patrolStep * Math.sin(patrolCourse);
                        
                        target.patternData.patrolDistance += Math.abs(patrolStep);
                        
                        if (target.patternData.patrolDistance >= target.patternData.patrolMaxDistance) {
                            target.patternData.patrolDirection *= -1;
                            target.patternData.patrolDistance = 0;
                        }
                        break;
                        
                    case 'random':
                        const randomCourse = Math.random() * 2 * Math.PI;
                        const randomDistance = distance * (0.5 + Math.random());
                        
                        newLat = target.latitude + (randomDistance / 111000) * Math.cos(randomCourse);
                        newLng = target.longitude + (randomDistance / (111000 * Math.cos(target.latitude * Math.PI / 180))) * Math.sin(randomCourse);
                        break;
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é —Ü–µ–ª–∏
                target.latitude = newLat;
                target.longitude = newLng;
                target.distance += distance;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏—Å—Ç–æ—Ä–∏—é —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏
                if (!targetHistory[target.id]) {
                    targetHistory[target.id] = [];
                }
                
                targetHistory[target.id].push({
                    lat: target.latitude,
                    lng: target.longitude,
                    timestamp: now
                });
                
                // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–ª–∏–Ω—É –∏—Å—Ç–æ—Ä–∏–∏
                if (targetHistory[target.id].length > maxTrajectoryPoints) {
                    targetHistory[target.id].shift();
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –º–∞—Ä–∫–µ—Ä –Ω–∞ –∫–∞—Ä—Ç–µ
                if (markers[target.id]) {
                    markers[target.id].setLatLng([target.latitude, target.longitude]);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–≤–æ—Ä–æ—Ç –º–∞—Ä–∫–µ—Ä–∞ –¥–ª—è –ª–∏–Ω–µ–π–Ω–æ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è
                    if (target.pattern === 'linear') {
                        const icon = getIconForType(target.type, target.course);
                        markers[target.id].setIcon(icon);
                    }
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏—é
                addTrajectory(target);
            });
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –∏–∫–æ–Ω–æ–∫ –º–∞—Ä–∫–µ—Ä–æ–≤
        function updateAllMarkerIcons() {
            targets.forEach(target => {
                if (markers[target.id]) {
                    const icon = getIconForType(target.type, target.course);
                    markers[target.id].setIcon(icon);
                }
            });
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–π
        function toggleTrajectories() {
            showTrajectories = !showTrajectories;
            
            const toggleText = document.getElementById('trajectoryToggleText');
            if (showTrajectories) {
                toggleText.textContent = '–ü—Ä–∏—Ö–æ–≤–∞—Ç–∏ —Ç—Ä–∞—î–∫—Ç–æ—Ä—ñ—ó';
                // –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏
                targets.forEach(target => {
                    addTrajectory(target);
                });
            } else {
                toggleText.textContent = '–ü–æ–∫–∞–∑–∞—Ç–∏ —Ç—Ä–∞—î–∫—Ç–æ—Ä—ñ—ó';
                // –°–∫—Ä—ã—Ç—å –≤—Å–µ —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏
                Object.values(polylines).forEach(polyline => {
                    map.removeLayer(polyline);
                });
            }
        }

        // –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–π
        function clearAllTrajectories() {
            if (!confirm('–û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ —Ç—Ä–∞—î–∫—Ç–æ—Ä—ñ—ó?')) return;
            
            Object.values(polylines).forEach(polyline => {
                map.removeLayer(polyline);
            });
            
            polylines = {};
            targetHistory = {};
            
            // –°–±—Ä–æ—Å–∏—Ç—å —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è
            targets.forEach(target => {
                target.distance = 0;
                targetHistory[target.id] = [{
                    lat: target.latitude,
                    lng: target.longitude,
                    timestamp: Date.now()
                }];
            });
            
            updateStats();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–π
        function updateTrajectorySettings() {
            trajectorySettings.opacity = parseFloat(document.getElementById('trajectoryOpacity').value);
            trajectorySettings.width = parseInt(document.getElementById('trajectoryWidth').value);
            trajectorySettings.length = parseInt(document.getElementById('trajectoryLength').value);
            trajectorySettings.animationSpeed = parseFloat(document.getElementById('animationSpeed').value);
            
            // –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
            document.getElementById('opacityValue').textContent = Math.round(trajectorySettings.opacity * 100) + '%';
            document.getElementById('widthValue').textContent = trajectorySettings.width + 'px';
            document.getElementById('lengthValue').textContent = trajectorySettings.length + ' —Ç–æ—á–æ–∫';
            document.getElementById('speedValue').textContent = trajectorySettings.animationSpeed + 'x';
            
            // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤–∞—Ç—å –≤—Å–µ —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏ —Å –Ω–æ–≤—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
            targets.forEach(target => {
                addTrajectory(target);
            });
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        function updatePerformanceSettings() {
            updateInterval = parseInt(document.getElementById('updateInterval').value);
            maxTrajectoryPoints = parseInt(document.getElementById('maxTrajectoryPoints').value);
            
            document.getElementById('intervalValue').textContent = updateInterval + 'ms';
            document.getElementById('maxPointsValue').textContent = maxTrajectoryPoints + ' —Ç–æ—á–æ–∫';
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–ª–∞–π–¥–µ—Ä–æ–≤
        function initializeRangeSliders() {
            updateTrajectorySettings();
            updatePerformanceSettings();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats() {
            const totalTargets = targets.length;
            const activeTargets = targets.filter(t => !pausedTargets.has(t.id)).length;
            const maxSpeed = Math.max(...targets.map(t => t.speed), 0);
            const avgSpeed = targets.length > 0 ? Math.round(targets.reduce((sum, t) => sum + t.speed, 0) / targets.length) : 0;
            const totalDistance = targets.reduce((sum, t) => sum + t.distance, 0);
            
            document.getElementById('totalTargets').textContent = totalTargets;
            document.getElementById('activeTargets').textContent = activeTargets;
            document.getElementById('maxSpeed').textContent = maxSpeed;
            document.getElementById('avgSpeed').textContent = avgSpeed;
            document.getElementById('totalDistance').textContent = Math.round(totalDistance / 1000);
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞–±–æ—Ç—ã
            const uptime = Date.now() - startTime;
            const hours = Math.floor(uptime / (1000 * 60 * 60));
            const minutes = Math.floor((uptime % (1000 * 60 * 60)) / (1000 * 60));
            document.getElementById('onlineTime').textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
        }

        // –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        function updateAdvancedStats() {
            updateStats();
            updateTargetTypesChart();
            updateGroupStats();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ —Ç–∏–ø–æ–≤ —Ü–µ–ª–µ–π
        function updateTargetTypesChart() {
            const ctx = document.getElementById('targetTypesChart').getContext('2d');
            
            // –ü–æ–¥—Å—á–µ—Ç —Ü–µ–ª–µ–π –ø–æ —Ç–∏–ø–∞–º
            const typeCounts = {};
            targets.forEach(target => {
                typeCounts[target.type] = (typeCounts[target.type] || 0) + 1;
            });
            
            const labels = Object.keys(typeCounts).map(type => targetTypes[type]?.name || type);
            const data = Object.values(typeCounts);
            const colors = Object.keys(typeCounts).map(type => fallbackIcons[type]?.color || '#636e72');
            
            if (targetChart) {
                targetChart.destroy();
            }
            
            targetChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors,
                        borderWidth: 2,
                        borderColor: '#2d3436'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#dfe6e9',
                                font: {
                                    size: 10
                                }
                            }
                        }
                    }
                }
            });
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –≥—Ä—É–ø–ø–∞–º
        function updateGroupStats() {
            const groupStats = document.getElementById('groupStats');
            groupStats.innerHTML = '';
            
            const groupCounts = {};
            targets.forEach(target => {
                const group = target.group || 'default';
                groupCounts[group] = (groupCounts[group] || 0) + 1;
            });
            
            Object.keys(groupCounts).forEach(groupKey => {
                const count = groupCounts[groupKey];
                const groupInfo = targetGroups[groupKey] || { name: groupKey, color: '#636e72' };
                
                const statCard = document.createElement('div');
                statCard.className = 'stat-card';
                statCard.innerHTML = `
                    <h4 style="color: ${groupInfo.color};">${count}</h4>
                    <p>${groupInfo.name}</p>
                `;
                
                groupStats.appendChild(statCard);
            });
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø–∞–Ω–µ–ª–∏
        function togglePanel() {
            const panel = document.getElementById('sidePanel');
            const button = document.querySelector('.toggle-panel-btn');
            
            isPanelExpanded = !isPanelExpanded;
            
            if (isPanelExpanded) {
                panel.classList.remove('collapsed');
                button.innerHTML = '<i class="fas fa-eye-slash"></i><span>–ü–∞–Ω–µ–ª—å</span>';
            } else {
                panel.classList.add('collapsed');
                button.innerHTML = '<i class="fas fa-eye"></i><span>–ü–∞–Ω–µ–ª—å</span>';
            }
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    console.log('–ü–æ–º–∏–ª–∫–∞ –≤—Ö–æ–¥—É –≤ –ø–æ–≤–Ω–æ–µ–∫—Ä–∞–Ω–Ω–∏–π —Ä–µ–∂–∏–º:', err);
                });
            } else {
                document.exitFullscreen();
            }
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏
        function toggleClustering() {
            isClusteringEnabled = !isClusteringEnabled;
            const button = document.getElementById('toggleClusterBtn');
            
            if (isClusteringEnabled) {
                button.innerHTML = '<i class="fas fa-object-group"></i>–ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü—ñ—è: –£–≤—ñ–º–∫–Ω–µ–Ω–∞';
                // –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –º–∞—Ä–∫–µ—Ä—ã –≤ –∫–ª–∞—Å—Ç–µ—Ä
                individualTargets.eachLayer(layer => {
                    individualTargets.removeLayer(layer);
                    markerCluster.addLayer(layer);
                });
            } else {
                button.innerHTML = '<i class="fas fa-object-ungroup"></i>–ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü—ñ—è: –í–∏–º–∫–Ω–µ–Ω–∞';
                // –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –º–∞—Ä–∫–µ—Ä—ã –∏–∑ –∫–ª–∞—Å—Ç–µ—Ä–∞
                markerCluster.eachLayer(layer => {
                    markerCluster.removeLayer(layer);
                    individualTargets.addLayer(layer);
                });
            }
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ —Å—Ç—Ä–µ–ª–æ–∫
        function toggleArrowMode() {
            arrowMode = !arrowMode;
            const button = document.getElementById('toggleArrowBtn');
            
            if (arrowMode) {
                button.innerHTML = '<i class="fas fa-times"></i>–í–∏–º–∫–Ω—É—Ç–∏ —Å—Ç—Ä—ñ–ª–∫–∏';
                map.getContainer().style.cursor = 'crosshair';
            } else {
                button.innerHTML = '<i class="fas fa-draw-polygon"></i>–†–µ–∂–∏–º —Å—Ç—Ä—ñ–ª–æ–∫';
                map.getContainer().style.cursor = '';
                
                if (tempArrowLine) {
                    map.removeLayer(tempArrowLine);
                    tempArrowLine = null;
                    tempArrowStartLatLng = null;
                }
            }
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–µ—Ç–æ–∫
        function toggleTimestamps() {
            showTimestamps = !showTimestamps;
            
            if (showTimestamps) {
                targets.forEach(target => {
                    addTimestampsToTrajectory(target);
                });
            } else {
                // –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏
                map.eachLayer(layer => {
                    if (layer instanceof L.CircleMarker && layer.getTooltip()) {
                        map.removeLayer(layer);
                    }
                });
            }
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å–µ—Ç–∫–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
        function toggleGrid() {
            showGrid = !showGrid;
            
            if (showGrid) {
                // –î–æ–±–∞–≤–∏—Ç—å —Å–µ—Ç–∫—É –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
                // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—É—é —Å–µ—Ç–∫—É
                console.log('–°–µ—Ç–∫–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –≤–∫–ª—é—á–µ–Ω–∞');
            } else {
                console.log('–°–µ—Ç–∫–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –≤—ã–∫–ª—é—á–µ–Ω–∞');
            }
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        function togglePerformanceMode() {
            performanceMode = !performanceMode;
            
            if (performanceMode) {
                alert('–†–µ–∂–∏–º –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ —É–≤—ñ–º–∫–Ω–µ–Ω–æ. –ê–Ω—ñ–º–∞—Ü—ñ—è –±—É–¥–µ –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏—Å—è —Ä—ñ–¥—à–µ –¥–ª—è –∫—Ä–∞—â–æ—ó –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ.');
            } else {
                alert('–†–µ–∂–∏–º –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –≤–∏–º–∫–Ω–µ–Ω–æ. –ê–Ω—ñ–º–∞—Ü—ñ—è –±—É–¥–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –Ω–∞ –ø–æ–≤–Ω—ñ–π —à–≤–∏–¥–∫–æ—Å—Ç—ñ.');
            }
        }

        // –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –∞–Ω–∏–º–∞—Ü–∏–∏
        function startAnimationLoop() {
            function animate() {
                frameCount++;
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ FPS –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
                const now = Date.now();
                if (now - lastFPSUpdate >= 1000) {
                    currentFPS = Math.round(frameCount * 1000 / (now - lastFPSUpdate));
                    document.getElementById('fpsCounter').textContent = currentFPS;
                    frameCount = 0;
                    lastFPSUpdate = now;
                }
                
                // –î–≤–∏–∂–µ–Ω–∏–µ —Ü–µ–ª–µ–π
                moveTargets();
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
                if (now - lastStatsUpdate >= 5000) {
                    updateStats();
                    lastStatsUpdate = now;
                }
                
                animationFrameId = requestAnimationFrame(animate);
            }
            
            animate();
        }

        // –ü–æ–∏—Å–∫ –≥–æ—Ä–æ–¥–æ–≤
        function performAutoSearch(query) {
            if (!query || query.length < 2) {
                document.getElementById('searchResults').style.display = 'none';
                return;
            }
            
            const results = ukraineCities.filter(city => 
                city.name.toLowerCase().includes(query.toLowerCase())
            ).slice(0, 10);
            
            displaySearchResults(results);
        }

        function performSearch() {
            const query = document.getElementById('searchInput').value.trim();
            if (!query) return;
            
            performAutoSearch(query);
        }

        function displaySearchResults(results) {
            const resultsContainer = document.getElementById('searchResults');
            
            if (results.length === 0) {
                resultsContainer.style.display = 'none';
                return;
            }
            
            resultsContainer.innerHTML = '';
            
            results.forEach(city => {
                const item = document.createElement('div');
                item.className = 'search-result-item';
                item.innerHTML = `
                    <strong>${city.name}</strong>
                    <br><small>${city.type}</small>
                `;
                
                item.addEventListener('click', () => {
                    map.setView([city.lat, city.lng], 10);
                    document.getElementById('searchInput').value = city.name;
                    resultsContainer.style.display = 'none';
                    
                    // –î–æ–±–∞–≤–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–π –º–∞—Ä–∫–µ—Ä
                    if (searchMarker) {
                        map.removeLayer(searchMarker);
                    }
                    
                    searchMarker = L.marker([city.lat, city.lng], {
                        icon: L.divIcon({
                            html: '<div style="background: #00cec9; width: 20px; height: 20px; border-radius: 50%; border: 2px solid white;"></div>',
                            className: 'search-marker',
                            iconSize: [20, 20],
                            iconAnchor: [10, 10]
                        })
                    }).addTo(map);
                    
                    setTimeout(() => {
                        if (searchMarker) {
                            map.removeLayer(searchMarker);
                            searchMarker = null;
                        }
                    }, 5000);
                });
                
                resultsContainer.appendChild(item);
            });
            
            resultsContainer.style.display = 'block';
        }

        // –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
        function exportTargets() {
            const data = {
                targets: targets,
                trajectorySettings: trajectorySettings,
                exportDate: new Date().toISOString(),
                version: "2.0"
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `targets_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            
            URL.revokeObjectURL(url);
        }

        // –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV
        function exportCSV() {
            const csvHeader = 'ID,–ù–∞–∑–≤–∞,–¢–∏–ø,–®–∏—Ä–æ—Ç–∞,–î–æ–≤–≥–æ—Ç–∞,–®–≤–∏–¥–∫—ñ—Å—Ç—å,–ö—É—Ä—Å,–ì—Ä—É–ø–∞,–ö–æ–ª—ñ—Ä,–í—ñ–¥—Å—Ç–∞–Ω—å,–°—Ç–≤–æ—Ä–µ–Ω–æ\n';
            const csvContent = targets.map(target => 
                `${target.id},${target.name},${target.type},${target.latitude},${target.longitude},${target.speed},${target.course},${target.group || 'default'},${target.trajectoryColor || '#ff0000'},${(target.distance / 1000).toFixed(1)},${target.createdAt}`
            ).join('\n');
            
            const blob = new Blob([csvHeader + csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `targets_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            
            URL.revokeObjectURL(url);
        }

        // –ò–º–ø–æ—Ä—Ç —Ñ–∞–π–ª–æ–≤
        function importTargets() {
            document.getElementById('importFile').click();
        }

        function handleFileImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    let data;
                    
                    if (file.name.endsWith('.json')) {
                        data = JSON.parse(e.target.result);
                        
                        if (data.targets && Array.isArray(data.targets)) {
                            const importCount = data.targets.length;
                            
                            if (confirm(`–Ü–º–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ ${importCount} —Ü—ñ–ª–µ–π? –¶–µ –¥–æ–¥–∞—Å—Ç—å —ó—Ö –¥–æ –ø–æ—Ç–æ—á–Ω–æ–≥–æ —Å–ø–∏—Å–∫—É.`)) {
                                data.targets.forEach(target => {
                                    target.id = Date.now().toString() + Math.random().toString(36).substr(2, 9);
                                    addTarget(target);
                                });
                                
                                if (data.trajectorySettings) {
                                    Object.assign(trajectorySettings, data.trajectorySettings);
                                    initializeRangeSliders();
                                }
                                
                                alert(`–£—Å–ø—ñ—à–Ω–æ —ñ–º–ø–æ—Ä—Ç–æ–≤–∞–Ω–æ ${importCount} —Ü—ñ–ª–µ–π!`);
                            }
                        } else {
                            throw new Error('–ù–µ–∫–æ—Ä–µ–∫—Ç–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª—É');
                        }
                    } else if (file.name.endsWith('.csv')) {
                        // –ü—Ä–æ—Å—Ç–æ–π –ø–∞—Ä—Å–µ—Ä CSV
                        const lines = e.target.result.split('\n');
                        const headers = lines[0].split(',');
                        
                        if (!headers.includes('–ù–∞–∑–≤–∞') || !headers.includes('–¢–∏–ø')) {
                            throw new Error('–ù–µ–∫–æ—Ä–µ–∫—Ç–Ω–∏–π CSV —Ñ–∞–π–ª');
                        }
                        
                        const importedTargets = [];
                        for (let i = 1; i < lines.length; i++) {
                            const line = lines[i].trim();
                            if (!line) continue;
                            
                            const values = line.split(',');
                            if (values.length >= 8) {
                                const target = createTarget(
                                    parseFloat(values[3]) || 50.45,
                                    parseFloat(values[4]) || 30.52,
                                    values[1] || '–Ü–º–ø–æ—Ä—Ç–æ–≤–∞–Ω–∞ —Ü—ñ–ª—å',
                                    values[2] || '–¥—Ä–æ–Ω',
                                    parseInt(values[5]) || 150,
                                    parseInt(values[6]) || 0,
                                    values[7] || 'default',
                                    values[8] || '#ff0000'
                                );
                                importedTargets.push(target);
                            }
                        }
                        
                        if (importedTargets.length > 0) {
                            if (confirm(`–Ü–º–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ ${importedTargets.length} —Ü—ñ–ª–µ–π –∑ CSV?`)) {
                                importedTargets.forEach(addTarget);
                                alert(`–£—Å–ø—ñ—à–Ω–æ —ñ–º–ø–æ—Ä—Ç–æ–≤–∞–Ω–æ ${importedTargets.length} —Ü—ñ–ª–µ–π!`);
                            }
                        }
                    }
                    
                } catch (error) {
                    console.error('–ü–æ–º–∏–ª–∫–∞ —ñ–º–ø–æ—Ä—Ç—É:', error);
                    alert('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ —ñ–º–ø–æ—Ä—Ç—ñ —Ñ–∞–π–ª—É: ' + error.message);
                }
            };
            
            reader.readAsText(file);
        }

        // –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö —Ü–µ–ª–µ–π
        function clearAllTargets() {
            if (!confirm('–í–∏–¥–∞–ª–∏—Ç–∏ –≤—Å—ñ —Ü—ñ–ª—ñ? –¶—è –¥—ñ—è –Ω–µ–∑–≤–æ—Ä–æ—Ç–Ω–∞!')) return;
            
            targets = [];
            
            Object.values(markers).forEach(marker => {
                if (isClusteringEnabled) {
                    markerCluster.removeLayer(marker);
                } else {
                    individualTargets.removeLayer(marker);
                }
            });
            
            Object.values(polylines).forEach(polyline => {
                map.removeLayer(polyline);
            });
            
            markers = {};
            polylines = {};
            targetHistory = {};
            pausedTargets.clear();
            
            updateTargetsList();
            updateStats();
            saveToLocalStorage();
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage
        function saveToLocalStorage() {
            try {
                const data = {
                    targets: targets,
                    trajectorySettings: trajectorySettings,
                    currentMovementPattern: currentMovementPattern,
                    performanceMode: performanceMode,
                    updateInterval: updateInterval,
                    maxTrajectoryPoints: maxTrajectoryPoints,
                    savedAt: Date.now()
                };
                localStorage.setItem('airTargetsData', JSON.stringify(data));
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è:', error);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ localStorage
        function loadTargetsFromLocalStorage() {
            try {
                const data = localStorage.getItem('airTargetsData');
                if (data) {
                    const parsed = JSON.parse(data);
                    
                    if (parsed.targets && Array.isArray(parsed.targets)) {
                        parsed.targets.forEach(target => {
                            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏—Å—Ç–æ—Ä–∏—é —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏
                            targetHistory[target.id] = [{
                                lat: target.latitude,
                                lng: target.longitude,
                                timestamp: target.createdAt ? new Date(target.createdAt).getTime() : Date.now()
                            }];
                            addTargetToMap(target);
                        });
                        targets = parsed.targets;
                        updateTargetsList();
                    }
                    
                    if (parsed.trajectorySettings) {
                        Object.assign(trajectorySettings, parsed.trajectorySettings);
                    }
                    
                    if (parsed.currentMovementPattern) {
                        setMovementPattern(parsed.currentMovementPattern);
                    }
                    
                    if (parsed.performanceMode !== undefined) {
                        performanceMode = parsed.performanceMode;
                    }
                    
                    if (parsed.updateInterval) {
                        updateInterval = parsed.updateInterval;
                    }
                    
                    if (parsed.maxTrajectoryPoints) {
                        maxTrajectoryPoints = parsed.maxTrajectoryPoints;
                    }
                    
                    console.log(`–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ ${targets.length} —Ü—ñ–ª–µ–π –∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å—Ö–æ–≤–∏—â–∞`);
                }
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑ localStorage:', error);
            }
        }

        // –û—á–∏—Å—Ç–∫–∞ localStorage
        function clearLocalStorage() {
            if (!confirm('–û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –¥–∞–Ω—ñ? –¶—è –¥—ñ—è –Ω–µ–∑–≤–æ—Ä–æ—Ç–Ω–∞!')) return;
            
            localStorage.removeItem('airTargetsData');
            localStorage.removeItem('warningShown');
            alert('–õ–æ–∫–∞–ª—å–Ω–µ —Å—Ö–æ–≤–∏—â–µ –æ—á–∏—â–µ–Ω–æ');
        }

        // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
        function startAutoSave() {
            autoSaveInterval = setInterval(() => {
                saveToLocalStorage();
            }, 30000); // –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
        function checkConnection() {
            const status = navigator.onLine ? '–û–Ω–ª–∞–π–Ω' : '–û—Ñ–ª–∞–π–Ω';
            const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
            
            let connectionInfo = `–°—Ç–∞—Ç—É—Å: ${status}\n`;
            if (connection) {
                connectionInfo += `–¢–∏–ø –∑'—î–¥–Ω–∞–Ω–Ω—è: ${connection.effectiveType || '–ù–µ–≤—ñ–¥–æ–º–æ'}\n`;
                connectionInfo += `–®–≤–∏–¥–∫—ñ—Å—Ç—å: ${connection.downlink || '–ù–µ–≤—ñ–¥–æ–º–æ'} Mbps`;
            }
            
            alert(connectionInfo);
        }

        // –ü—Ä–æ—Å—Ç—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å –æ—Ä–∏–≥–∏–Ω–∞–ª–æ–º
        function showLoginModal() {
            document.getElementById('loginModal').style.display = 'block';
        }

        function closeLoginModal() {
            document.getElementById('loginModal').style.display = 'none';
        }

        function attemptLogin() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            // –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é)
            if (email === 'admin@example.com' && password === 'admin') {
                isAdmin = true;
                updateUIForUserRole();
                closeLoginModal();
                alert('–í–∏ —É–≤—ñ–π—à–ª–∏ —è–∫ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä');
            } else {
                alert('–ù–µ–≤—ñ—Ä–Ω–∏–π email –∞–±–æ –ø–∞—Ä–æ–ª—å');
            }
        }

        function logout() {
            isAdmin = false;
            updateUIForUserRole();
        }

        function updateUIForUserRole() {
            const loginBtn = document.querySelector('.login-btn');
            const logoutBtn = document.getElementById('logoutBtn');
            
            if (isAdmin) {
                loginBtn.style.display = 'none';
                logoutBtn.style.display = 'flex';
            } else {
                loginBtn.style.display = 'flex';
                logoutBtn.style.display = 'none';
            }
            
            updateTargetsList();
        }

        function updateStatus() {
            const statusDot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');
            
            if (isOnline) {
                statusDot.className = 'online-dot';
                statusText.textContent = '–û–Ω–ª–∞–π–Ω';
                statusText.style.color = '#00b894';
            } else {
                statusDot.className = 'offline-dot';
                statusText.textContent = '–õ–æ–∫–∞–ª—å–Ω–∏–π —Ä–µ–∂–∏–º';
                statusText.style.color = '#f39c12';
            }
            
            document.getElementById('lastUpdate').textContent = 
                '–û–Ω–æ–≤–ª–µ–Ω–æ: ' + new Date().toLocaleTimeString('uk-UA');
        }

        // –ó–∞–≥–ª—É—à–∫–∏ –¥–ª—è Firebase —Ñ—É–Ω–∫—Ü–∏–π
        function initFirebase() {
            try {
                if (typeof firebase !== 'undefined' && firebaseConfig) {
                    firebase.initializeApp(firebaseConfig);
                    isOnline = true;
                    console.log('Firebase —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ');
                } else {
                    console.log('Firebase –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π, –ø—Ä–∞—Ü—é—î–º–æ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º—É —Ä–µ–∂–∏–º—ñ');
                }
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó Firebase:', error);
            }
            updateStatus();
        }

        function reconnectFirebase() {
            console.log("–°–ø—Ä–æ–±–∞ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ Firebase...");
            initFirebase();
        }

        // –ó–∞–≥–ª—É—à–∫–∏ –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π –∫–æ—Ç–æ—Ä—ã–µ –µ—Å—Ç—å –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ –Ω–æ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∑–¥–µ—Å—å
        function showCourseSelectionModal() { console.log('Course selection modal'); }
        function confirmCourseSelection() { console.log('Course confirmed'); }
        function cancelCourseSelection() { console.log('Course cancelled'); }
        function handleArrowClick() { console.log('Arrow click'); }
        function updateTargetClusters() { console.log('Update clusters'); }
        function addTargetAtPosition() { console.log('Add target at position'); }
        function setTargetCourseFromMap() { console.log('Set course from map'); }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', initApp);
