<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞—Ä—Ç–∞ –ø–æ–≤—ñ—Ç—Ä—è–Ω–∏—Ö —Ü—ñ–ª–µ–π</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { padding: 20px; background: #1a1f2d; color: white; font-family: Arial, sans-serif; }
        #map { height: 600px; width: 100%; border: 2px solid #a38d6d; border-radius: 8px; margin-bottom: 20px; }
        .btn { padding: 10px 15px; background: #a38d6d; color: white; border: none; border-radius: 5px; margin: 5px; cursor: pointer; text-decoration: none; display: inline-block; }
        .btn:hover { background: #8a7559; }
        .controls { margin: 10px 0; display: flex; flex-wrap: wrap; }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ü–µ–ª–µ–π */
        .target-item {
            padding: 10px;
            margin: 5px 0;
            background: #2c3e50;
            border-radius: 5px;
            cursor: pointer;
        }
        .target-item:hover {
            background: #34495e;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç—Ä–µ—É–≥–æ–ª—å–Ω—ã—Ö –º–∞—Ä–∫–µ—Ä–æ–≤ */
        .triangle-icon {
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-bottom: 16px solid;
        }
    </style>
</head>
<body>
    <h1>üó∫Ô∏è –ö–∞—Ä—Ç–∞ –ø–æ–≤—ñ—Ç—Ä—è–Ω–∏—Ö —Ü—ñ–ª–µ–π</h1>

    <div class="controls">
        <button class="btn" onclick="centerMap()">üéØ –¶–µ–Ω—Ç—Ä—É–≤–∞—Ç–∏</button>
        <button class="btn" onclick="togglePause()" id="pauseBtn">‚è∏Ô∏è –ü–∞—É–∑–∞</button>
        <button class="btn" onclick="toggleMapView()" id="mapViewBtn">üõ∞Ô∏è –°—É–ø—É—Ç–Ω–∏–∫</button>
    </div>

    <div id="map"></div>

    <h3>üéØ –ê–∫—Ç–∏–≤–Ω—ñ —Ü—ñ–ª—ñ:</h3>
    <div id="targetsList">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let map;
        let markers = {};
        let animationPaused = false;
        let currentMapView = 'street';
        let baseLayers = {};
        let targets = [];
        let animationInterval;
        let lastFrameTime = performance.now();

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã
        function initMap() {
            console.log("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã...");
            map = L.map('map').setView([50.4501, 30.5234], 6);

            // –°–ª–æ–∏ –∫–∞—Ä—Ç—ã
            baseLayers.street = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors',
                maxZoom: 19
            });

            baseLayers.satellite = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                attribution: '¬© Esri',
                maxZoom: 19
            });

            baseLayers.street.addTo(map);
            loadTargets();
            startAnimation();
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ü–µ–ª–µ–π
        function loadTargets() {
            targets = [
                {id: 1, name: "F-16", type: "–≤–∏–Ω–∏—â—É–≤–∞—á", speed: 800, course: 45, lat: 50.45, lng: 30.52},
                {id: 2, name: "Shahed-136", type: "–¥—Ä–æ–Ω", speed: 180, course: 120, lat: 49.0, lng: 31.0}
            ];
            updateTargetsList();
            updateMapMarkers();
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–æ–≥–æ –º–∞—Ä–∫–µ—Ä–∞
        function createTriangleIcon(type, course) {
            const colors = {
                '–≤–∏–Ω–∏—â—É–≤–∞—á': '#3498db',
                '–¥—Ä–æ–Ω': '#e74c3c',
                '—Ä–∞–∫–µ—Ç–∞': '#f39c12',
                '–±–æ–º–±–∞': '#95a5a6',
                '–∫–æ—Ä–∞–±–ª—å': '#9b59b6'
            };

            const color = colors[type] || '#3498db';
            const rotation = course;

            return L.divIcon({
                className: 'target-icon',
                html: `<div class="triangle-icon" style="border-bottom-color: ${color}; transform: rotate(${rotation}deg);"></div>`,
                iconSize: [20, 20],
                iconAnchor: [10, 10]
            });
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–æ–≤ –Ω–∞ –∫–∞—Ä—Ç–µ
        function updateMapMarkers() {
            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –º–∞—Ä–∫–µ—Ä—ã
            for (const id in markers) {
                map.removeLayer(markers[id]);
            }
            markers = {};

            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –º–∞—Ä–∫–µ—Ä—ã
            targets.forEach(target => {
                const icon = createTriangleIcon(target.type, target.course);
                const marker = L.marker([target.lat, target.lng], {icon: icon})
                    .addTo(map)
                    .bindPopup(`
                        <b>${target.name}</b><br>
                        –¢–∏–ø: ${target.type}<br>
                        –®–≤–∏–¥–∫—ñ—Å—Ç—å: ${target.speed} –∫–º/–≥–æ–¥<br>
                        –ö—É—Ä—Å: ${target.course}¬∞
                    `);

                markers[target.id] = marker;
            });
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ü–µ–ª–µ–π
        function updateTargetsList() {
            const container = document.getElementById('targetsList');
            container.innerHTML = '';

            targets.forEach(target => {
                const div = document.createElement('div');
                div.className = 'target-item';
                div.innerHTML = `
                    <strong>${target.name}</strong> (${target.type})<br>
                    –®–≤–∏–¥–∫—ñ—Å—Ç—å: ${target.speed} –∫–º/–≥–æ–¥, –ö—É—Ä—Å: ${Math.round(target.course)}¬∞<br>
                    –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏: ${target.lat.toFixed(4)}, ${target.lng.toFixed(4)}
                `;
                container.appendChild(div);
            });
        }

        // –ó–∞–ø—É—Å–∫ –∞–Ω–∏–º–∞—Ü–∏–∏
        function startAnimation() {
            if (animationInterval) clearInterval(animationInterval);
            lastFrameTime = performance.now();
            animationInterval = setInterval(moveTargets, 50);
        }

        // –î–≤–∏–∂–µ–Ω–∏–µ —Ü–µ–ª–µ–π
        function moveTargets() {
            if (animationPaused) return;

            const now = performance.now();
            const deltaTime = (now - lastFrameTime) / 1000;
            lastFrameTime = now;

            targets.forEach(target => {
                if (target.speed > 0) {
                    // –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ
                    const speedKmPerSecond = target.speed / 3600;
                    const latDegreesPerKm = 1 / 111.0;
                    const lngDegreesPerKm = 1 / (111.0 * Math.cos(target.lat * Math.PI / 180));

                    const speedDegreesPerSecond = speedKmPerSecond * latDegreesPerKm;
                    const courseRad = (target.course - 90) * Math.PI / 180;

                    const deltaLat = Math.sin(courseRad) * speedDegreesPerSecond * deltaTime;
                    const deltaLng = Math.cos(courseRad) * speedDegreesPerSecond * deltaTime *
                                    (latDegreesPerKm / lngDegreesPerKm);

                    target.lat += deltaLat;
                    target.lng += deltaLng;

                    // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –º–∞—Ä–∫–µ—Ä–∞
                    if (markers[target.id]) {
                        markers[target.id].setLatLng([target.lat, target.lng]);
                        const newIcon = createTriangleIcon(target.type, target.course);
                        markers[target.id].setIcon(newIcon);
                    }
                }
            });
            updateTargetsList();
        }

        // –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç—ã
        function centerMap() {
            map.setView([50.4501, 30.5234], 6);
        }

        // –ü–∞—É–∑–∞/–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
        function togglePause() {
            animationPaused = !animationPaused;
            const btn = document.getElementById('pauseBtn');
            btn.textContent = animationPaused ? '‚ñ∂Ô∏è –í—ñ–¥—Ç–≤–æ—Ä–∏—Ç–∏' : '‚è∏Ô∏è –ü–∞—É–∑–∞';
            btn.style.background = animationPaused ? '#27ae60' : '#a38d6d';
            if (!animationPaused) {
                lastFrameTime = performance.now();
            }
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–∞ –∫–∞—Ä—Ç—ã
        function toggleMapView() {
            if (currentMapView === 'street') {
                map.removeLayer(baseLayers.street);
                baseLayers.satellite.addTo(map);
                currentMapView = 'satellite';
                document.getElementById('mapViewBtn').textContent = 'üó∫Ô∏è –ú–∞–ø–∞';
            } else {
                map.removeLayer(baseLayers.satellite);
                baseLayers.street.addTo(map);
                currentMapView = 'street';
                document.getElementById('mapViewBtn').textContent = 'üõ∞Ô∏è –°—É–ø—É—Ç–Ω–∏–∫';
            }
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = initMap;
    </script>
</body>
</html>
