<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞—Ä—Ç–∞ –ø–æ–≤—ñ—Ç—Ä—è–Ω–∏—Ö —Ü—ñ–ª–µ–π</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { padding: 20px; background: #1a1f2d; color: white; font-family: Arial, sans-serif; }
        #map { 
            height: 600px; 
            width: 100%; 
            border: 2px solid #a38d6d; 
            border-radius: 8px; 
            margin-bottom: 20px;
        }
        .btn { 
            padding: 10px 15px; 
            background: #a38d6d; 
            color: white; 
            border: none; 
            border-radius: 5px; 
            margin: 5px; 
            cursor: pointer; 
            font-size: 14px;
        }
        .btn:hover { background: #8a7559; }
        .controls { margin: 10px 0; display: flex; flex-wrap: wrap; }
        
        .target-item {
            padding: 10px;
            margin: 5px 0;
            background: #2c3e50;
            border-radius: 5px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: #2c3e50;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #a38d6d;
            width: 300px;
        }
        .modal input, .modal select {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #a38d6d;
            border-radius: 5px;
            background: #1a1f2d;
            color: white;
        }
    </style>
</head>
<body>
    <h1>üó∫Ô∏è –ö–∞—Ä—Ç–∞ –ø–æ–≤—ñ—Ç—Ä—è–Ω–∏—Ö —Ü—ñ–ª–µ–π</h1>
    <div id="syncInfo">–õ–æ–∫–∞–ª—å–Ω–∏–π —Ä–µ–∂–∏–º</div>

    <div class="controls">
        <button class="btn" onclick="centerMap()">üéØ –¶–µ–Ω—Ç—Ä—É–≤–∞—Ç–∏</button>
        <button class="btn" onclick="toggleAddMode()" id="addModeBtn">üìç –î–æ–¥–∞—Ç–∏ —Ü—ñ–ª—å</button>
        <button class="btn" onclick="togglePause()" id="pauseBtn">‚è∏Ô∏è –ü–∞—É–∑–∞</button>
        <button class="btn" onclick="toggleTrails()" id="trailsBtn">üî¥ –¢—Ä–∞—î–∫—Ç–æ—Ä—ñ—ó</button>
        <button class="btn" onclick="showAllTargets()">üëÅÔ∏è –ü–æ–∫–∞–∑–∞—Ç–∏ –≤—Å—ñ —Ü—ñ–ª—ñ</button>
        <button class="btn" onclick="forceSync()">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏</button>
    </div>

    <div id="map"></div>

    <h3>üéØ –ê–∫—Ç–∏–≤–Ω—ñ —Ü—ñ–ª—ñ:</h3>
    <div id="targetsList">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>

    <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ü–µ–ª–∏ -->
    <div id="targetForm" class="modal">
        <div class="modal-content">
            <h3>‚ûï –î–æ–¥–∞—Ç–∏ —Ü—ñ–ª—å</h3>
            <input type="text" id="targetName" placeholder="–ù–∞–∑–≤–∞ —Ü—ñ–ª—ñ" value="–¶—ñ–ª—å">
            <input type="number" id="targetSpeed" placeholder="–®–≤–∏–¥–∫—ñ—Å—Ç—å (–∫–º/–≥–æ–¥)" value="100">
            <input type="number" id="targetCourse" placeholder="–ö—É—Ä—Å (0-360¬∞)" value="90" min="0" max="360">
            <select id="targetType">
                <option value="–≤–∏–Ω–∏—â—É–≤–∞—á">–í–∏–Ω–∏—â—É–≤–∞—á</option>
                <option value="–¥—Ä–æ–Ω">–î—Ä–æ–Ω</option>
                <option value="—Ä–∞–∫–µ—Ç–∞">–†–∞–∫–µ—Ç–∞</option>
            </select>
            <div style="margin-top:15px;">
                <button class="btn" onclick="addTarget()">üíæ –î–æ–¥–∞—Ç–∏</button>
                <button class="btn" onclick="hideTargetForm()" style="background:#e74c3c;">‚ùå –°–∫–∞—Å—É–≤–∞—Ç–∏</button>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
let map;
let targets = [];
let nextId = 1;
let animationPaused = false;

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã
function initMap() {
    console.log("–Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –∫–∞—Ä—Ç–∏...");
    
    try {
        map = L.map('map').setView([50.4501, 30.5234], 6);
        
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors'
        }).addTo(map);
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        loadFromLocalStorage();
        updateTargetsList();
        
        console.log("–ö–∞—Ä—Ç–∞ —É—Å–ø—ñ—à–Ω–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞");
        
    } catch (error) {
        console.error("–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–∞—Ä—Ç–∏:", error);
        document.getElementById('syncInfo').textContent = "–ü–æ–º–∏–ª–∫–∞ –∫–∞—Ä—Ç–∏, –∞–ª–µ –¥–∞–Ω—ñ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ";
        loadFromLocalStorage();
        updateTargetsList();
    }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ LocalStorage
function loadFromLocalStorage() {
    const savedData = localStorage.getItem('airTargetsData');
    if (savedData) {
        try {
            const data = JSON.parse(savedData);
            targets = data.targets || [];
            nextId = data.nextId || 1;
            console.log("–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ —Ü—ñ–ª–µ–π:", targets.length);
        } catch (error) {
            console.error("–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö:", error);
            targets = [];
            nextId = 1;
        }
    }
}

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ LocalStorage
function saveToLocalStorage() {
    const data = {
        targets: targets,
        nextId: nextId,
        lastUpdate: Date.now()
    };
    localStorage.setItem('airTargetsData', JSON.stringify(data));
    document.getElementById('syncInfo').textContent = "–ó–±–µ—Ä–µ–∂–µ–Ω–æ: " + new Date().toLocaleTimeString();
}

// –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
function toggleAddMode() {
    const form = document.getElementById('targetForm');
    if (form.style.display === 'flex') {
        form.style.display = 'none';
    } else {
        form.style.display = 'flex';
        // –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–ª–µ–π
        document.getElementById('targetName').value = '–¶—ñ–ª—å ' + nextId;
    }
}

function hideTargetForm() {
    document.getElementById('targetForm').style.display = 'none';
}

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π —Ü–µ–ª–∏
function addTarget() {
    const name = document.getElementById('targetName').value;
    const speed = parseInt(document.getElementById('targetSpeed').value) || 100;
    const course = parseInt(document.getElementById('targetCourse').value) || 90;
    const type = document.getElementById('targetType').value;
    
    if (!name) {
        alert("–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É —Ü—ñ–ª—ñ");
        return;
    }
    
    const center = map.getCenter();
    const newTarget = {
        id: nextId++,
        name: name,
        type: type,
        speed: speed,
        course: course,
        lat: center.lat,
        lng: center.lng
    };
    
    targets.push(newTarget);
    updateTargetsList();
    saveToLocalStorage();
    hideTargetForm();
    
    // –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Ä–∫–µ—Ä –Ω–∞ –∫–∞—Ä—Ç—É
    addMarkerToMap(newTarget);
}

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–∞ –Ω–∞ –∫–∞—Ä—Ç—É
function addMarkerToMap(target) {
    const marker = L.marker([target.lat, target.lng])
        .addTo(map)
        .bindPopup(`
            <b>${target.name}</b><br>
            –¢–∏–ø: ${target.type}<br>
            –®–≤–∏–¥–∫—ñ—Å—Ç—å: ${target.speed} –∫–º/–≥–æ–¥<br>
            –ö—É—Ä—Å: ${target.course}¬∞
        `);
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ü–µ–ª–µ–π
function updateTargetsList() {
    const container = document.getElementById('targetsList');
    container.innerHTML = '';
    
    if (targets.length === 0) {
        container.innerHTML = '<div class="target-item">–ù–µ–º–∞—î –∞–∫—Ç–∏–≤–Ω–∏—Ö —Ü—ñ–ª–µ–π</div>';
        return;
    }
    
    targets.forEach(target => {
        const div = document.createElement('div');
        div.className = 'target-item';
        div.innerHTML = `
            <strong>${target.name}</strong> (${target.type})<br>
            –®–≤–∏–¥–∫—ñ—Å—Ç—å: ${target.speed} –∫–º/–≥–æ–¥, –ö—É—Ä—Å: ${target.course}¬∞<br>
            –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏: ${target.lat.toFixed(4)}, ${target.lng.toFixed(4)}
        `;
        container.appendChild(div);
    });
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫
function centerMap() {
    if (map) {
        map.setView([50.4501, 30.5234], 6);
    }
}

function togglePause() {
    animationPaused = !animationPaused;
    const btn = document.getElementById('pauseBtn');
    btn.textContent = animationPaused ? '‚ñ∂Ô∏è –ü—É—Å–∫' : '‚è∏Ô∏è –ü–∞—É–∑–∞';
    btn.style.background = animationPaused ? '#27ae60' : '#a38d6d';
}

function toggleTrails() {
    alert("–§—É–Ω–∫—Ü—ñ—è —Ç—Ä–∞—î–∫—Ç–æ—Ä—ñ–π –±—É–¥–µ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ –ø—ñ–∑–Ω—ñ—à–µ");
}

function showAllTargets() {
    if (targets.length > 0 && map) {
        const group = new L.featureGroup(targets.map(t => L.marker([t.lat, t.lng])));
        map.fitBounds(group.getBounds());
    }
}

function forceSync() {
    saveToLocalStorage();
}

// –£–¥–∞–ª–µ–Ω–∏–µ —Ü–µ–ª–∏ –ø–æ –¥–≤–æ–π–Ω–æ–º—É –∫–ª–∏–∫—É
function setupTargetDeletion() {
    document.getElementById('targetsList').addEventListener('dblclick', function(e) {
        if (e.target.classList.contains('target-item')) {
            const targetText = e.target.querySelector('strong').textContent;
            if (confirm(`–í–∏–¥–∞–ª–∏—Ç–∏ —Ü—ñ–ª—å "${targetText}"?`)) {
                const targetName = targetText.split(' (')[0];
                const index = targets.findIndex(t => t.name === targetName);
                if (index !== -1) {
                    targets.splice(index, 1);
                    updateTargetsList();
                    saveToLocalStorage();
                    // TODO: —É–¥–∞–ª–∏—Ç—å –º–∞—Ä–∫–µ—Ä —Å –∫–∞—Ä—Ç—ã
                }
            }
        }
    });
}

// –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
window.addEventListener('load', function() {
    initMap();
    setupTargetDeletion();
    // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –µ—Å–ª–∏ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö
    if (targets.length === 0) {
        targets = [
            {id: nextId++, name: "F-16", type: "–≤–∏–Ω–∏—â—É–≤–∞—á", speed: 800, course: 45, lat: 50.45, lng: 30.52},
            {id: nextId++, name: "Shahed-136", type: "–¥—Ä–æ–Ω", speed: 180, course: 120, lat: 49.0, lng: 31.0}
        ];
        updateTargetsList();
        saveToLocalStorage();
    }
});
    </script>
</body>
</html>
