<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞—Ä—Ç–∞ –ø–æ–≤—ñ—Ç—Ä—è–Ω–∏—Ö —Ü—ñ–ª–µ–π</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <style>
        :root {
            --primary: #3498db;
            --fighter: #3498db;
            --drone: #e74c3c;
            --rocket: #f39c12;
            --bomb: #95a5a6;
            --ship: #9b59b6;
            --helicopter: #2ecc71;
            --transport: #f1c40f;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --dark-bg: linear-gradient(135deg, #1a1f2d 0%, #2c3e50 100%);
            --card-bg: #2c3e50;
            --border: #a38d6d;
            --text: #ecf0f1;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            padding: 20px; 
            background: var(--dark-bg); 
            color: var(--text); 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo h1 {
            font-size: 28px;
            background: linear-gradient(45deg, var(--primary), var(--helicopter));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        #map { 
            height: 700px; 
            width: 100%; 
            border: 2px solid var(--border); 
            border-radius: 12px; 
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }

        .btn {
            padding: 12px 18px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            margin: 5px;
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
        }

        .btn i { font-size: 16px; }

        .btn-danger { background: var(--danger); }
        .btn-danger:hover { box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4); }

        .btn-success { background: var(--success); }
        .btn-success:hover { box-shadow: 0 6px 20px rgba(39, 174, 96, 0.4); }

        .btn-warning { background: var(--warning); }
        .btn-warning:hover { box-shadow: 0 6px 20px rgba(243, 156, 18, 0.4); }

        .controls {
            margin: 20px 0;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: var(--card-bg);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid var(--primary);
        }

        .stat-card h3 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 14px;
            text-transform: uppercase;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
        }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 10000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 15px;
            border: 2px solid var(--border);
            width: 90%;
            max-width: 400px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        .modal input, .modal select, .modal textarea {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: rgba(26, 31, 45, 0.8);
            color: var(--text);
            transition: all 0.3s ease;
        }

        .modal input:focus, .modal select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ü–µ–ª–µ–π */
        .targets-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 1024px) {
            .targets-container {
                grid-template-columns: 1fr;
            }
        }

        .targets-section {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            max-height: 400px;
            overflow-y: auto;
        }

        .target-item {
            padding: 15px;
            margin: 8px 0;
            background: rgba(52, 73, 94, 0.6);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 4px solid var(--primary);
        }

        .target-item:hover {
            background: rgba(52, 73, 94, 0.9);
            transform: translateX(5px);
        }

        .target-item.selected {
            background: rgba(41, 128, 185, 0.3);
            border-left-color: var(--success);
        }

        .target-type {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 8px;
        }

        .type-fighter { background: var(--fighter); }
        .type-drone { background: var(--drone); }
        .type-rocket { background: var(--rocket); }
        .type-bomb { background: var(--bomb); }
        .type-ship { background: var(--ship); }
        .type-helicopter { background: var(--helicopter); }
        .type-transport { background: var(--transport); }

        /* –¢—Ä–µ—É–≥–æ–ª—å–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã */
        .triangle-icon {
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-bottom: 20px solid;
        }

        /* –ü–æ–∏—Å–∫ */
        .search-container { 
            margin: 15px 0; 
            position: relative;
            max-width: 400px;
        }

        #searchInput { 
            width: 100%; 
            padding: 12px 45px 12px 15px;
            border: 1px solid var(--border); 
            border-radius: 25px; 
            background: var(--card-bg); 
            color: var(--text);
            transition: all 0.3s ease;
        }

        #searchInput:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary);
        }

        #searchResults { 
            position: absolute; 
            background: var(--card-bg); 
            border: 1px solid var(--border); 
            max-height: 250px; 
            overflow-y: auto; 
            width: 100%; 
            display: none; 
            z-index: 1000;
            border-radius: 0 0 8px 8px;
            top: 100%;
        }

        .search-result { 
            padding: 12px; 
            cursor: pointer; 
            border-bottom: 1px solid var(--border);
            transition: all 0.2s ease;
        }

        .search-result:hover { 
            background: rgba(52, 152, 219, 0.2);
        }

        /* –°–∫—Ä—ã—Ç—ã–µ –º–∞—Ä–∫–µ—Ä—ã */
        .target-icon.hidden {
            opacity: 0.4;
            filter: grayscale(0.8);
        }

        /* –°—Ç–∞—Ç—É—Å –±–∞—Ä */
        .status-bar {
            position: fixed;
            bottom: 15px;
            right: 15px;
            background: var(--card-bg);
            padding: 12px 20px;
            border-radius: 25px;
            border: 1px solid var(--border);
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            z-index: 1000;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
        }

        .toast {
            background: var(--card-bg);
            color: white;
            padding: 15px 20px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            animation: slideIn 0.3s ease;
        }

        .toast.success { border-left-color: var(--success); }
        .toast.warning { border-left-color: var(--warning); }
        .toast.error { border-left-color: var(--danger); }
        .toast.info { border-left-color: var(--primary); }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é */
        .context-menu {
            position: fixed;
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 10px 0;
            z-index: 1000;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            display: none;
        }

        .context-menu-item {
            padding: 10px 20px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .context-menu-item:hover {
            background: rgba(52, 152, 219, 0.2);
        }

        /* –ì—Ä—É–ø–ø–æ–≤–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ */
        .group-controls {
            display: none;
            background: var(--card-bg);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid var(--warning);
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            body { padding: 10px; }
            #map { height: 400px; }
            .controls { flex-direction: column; }
            .btn { width: 100%; margin: 5px 0; }
            .stats-grid { grid-template-columns: 1fr; }
            .status-bar { 
                bottom: 10px;
                right: 10px;
                left: 10px;
                flex-direction: column;
                gap: 8px;
            }
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        .fade-in {
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä */
        .progress-bar {
            width: 100%;
            height: 4px;
            background: rgba(255,255,255,0.2);
            border-radius: 2px;
            overflow: hidden;
            margin: 5px 0;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary);
            border-radius: 2px;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-radar fa-2x" style="color: var(--primary);"></i>
                <h1>–°–∏—Å—Ç–µ–º–∞ –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –ø–æ–≤—ñ—Ç—Ä—è–Ω–∏—Ö —Ü—ñ–ª–µ–π</h1>
            </div>
            <div class="header-controls">
                <button class="btn" onclick="showHelp()">
                    <i class="fas fa-question-circle"></i>–î–æ–≤—ñ–¥–∫–∞
                </button>
            </div>
        </header>

        <div class="stats-grid">
            <div class="stat-card">
                <h3><i class="fas fa-crosshairs"></i> –í—Å—å–æ–≥–æ —Ü—ñ–ª–µ–π</h3>
                <div class="stat-value" id="totalTargets">0</div>
            </div>
            <div class="stat-card">
                <h3><i class="fas fa-eye"></i> –í–∏–¥–∏–º—ñ —Ü—ñ–ª—ñ</h3>
                <div class="stat-value" id="visibleTargets">0</div>
            </div>
            <div class="stat-card">
                <h3><i class="fas fa-tachometer-alt"></i> –°–µ—Ä–µ–¥–Ω—è —à–≤–∏–¥–∫—ñ—Å—Ç—å</h3>
                <div class="stat-value" id="avgSpeed">0 –∫–º/–≥–æ–¥</div>
            </div>
            <div class="stat-card">
                <h3><i class="fas fa-clock"></i> –ß–∞—Å —Ä–æ–±–æ—Ç–∏</h3>
                <div class="stat-value" id="uptime">00:00:00</div>
            </div>
        </div>

        <div class="search-container">
            <input type="text" id="searchInput" placeholder="–ü–æ—à—É–∫ –Ω–∞—Å–µ–ª–µ–Ω–æ–≥–æ –ø—É–Ω–∫—Ç—É...">
            <i class="fas fa-search search-icon"></i>
            <div id="searchResults"></div>
        </div>

        <div class="controls">
            <button class="btn" onclick="centerMap()">
                <i class="fas fa-crosshairs"></i>–¶–µ–Ω—Ç—Ä—É–≤–∞—Ç–∏
            </button>
            <button class="btn" onclick="toggleAddMode()" id="addModeBtn">
                <i class="fas fa-plus"></i>–î–æ–¥–∞—Ç–∏ —Ü—ñ–ª—å
            </button>
            <button class="btn" onclick="togglePause()" id="pauseBtn">
                <i class="fas fa-pause"></i>–ü–∞—É–∑–∞
            </button>
            <button class="btn" onclick="toggleTrails()" id="trailsBtn">
                <i class="fas fa-route"></i>–¢—Ä–∞—î–∫—Ç–æ—Ä—ñ—ó
            </button>
            <button class="btn" onclick="toggleMapView()" id="mapViewBtn">
                <i class="fas fa-satellite"></i>–°—É–ø—É—Ç–Ω–∏–∫
            </button>
            <button class="btn" onclick="showAllTargets()">
                <i class="fas fa-eye"></i>–ü–æ–∫–∞–∑–∞—Ç–∏ –≤—Å—ñ
            </button>
            <button class="btn btn-warning" onclick="showGroupControls()">
                <i class="fas fa-object-group"></i>–ì—Ä—É–ø–æ–≤–µ –∫–µ—Ä—É–≤–∞–Ω–Ω—è
            </button>
            <button class="btn btn-danger" onclick="clearAllTargets()">
                <i class="fas fa-trash"></i>–û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ
            </button>
            <button class="btn btn-success" onclick="exportData()">
                <i class="fas fa-download"></i>–ï–∫—Å–ø–æ—Ä—Ç
            </button>
        </div>

        <div class="group-controls" id="groupControls">
            <h3><i class="fas fa-object-group"></i> –ì—Ä—É–ø–æ–≤–µ –∫–µ—Ä—É–≤–∞–Ω–Ω—è</h3>
            <div style="display: flex; gap: 10px; margin: 10px 0;">
                <input type="number" id="groupSpeed" placeholder="–®–≤–∏–¥–∫—ñ—Å—Ç—å" class="modal-input">
                <input type="number" id="groupCourse" placeholder="–ö—É—Ä—Å" min="0" max="360" class="modal-input">
                <button class="btn btn-success" onclick="applyGroupSettings()">
                    <i class="fas fa-check"></i>–ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏
                </button>
            </div>
            <div id="selectedCount">–í–∏–±—Ä–∞–Ω—ñ —Ü—ñ–ª—ñ: 0</div>
        </div>

        <div id="map"></div>

        <div class="targets-container">
            <div class="targets-section">
                <h3><i class="fas fa-list"></i> –ê–∫—Ç–∏–≤–Ω—ñ —Ü—ñ–ª—ñ</h3>
                <div id="targetsList">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
            </div>
            
            <div class="targets-section">
                <h3><i class="fas fa-chart-line"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä—É—Ö—É</h3>
                <div id="targetsStats">
                    <p>–û–±–µ—Ä—ñ—Ç—å —Ü—ñ–ª—å –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</p>
                </div>
            </div>
        </div>
    </div>

    <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ü–µ–ª–∏ -->
    <div id="targetForm" class="modal">
        <div class="modal-content">
            <h3 id="formTitle"><i class="fas fa-plus"></i> –î–æ–¥–∞—Ç–∏ —Ü—ñ–ª—å</h3>
            <input type="hidden" id="targetId">
            
            <input type="text" id="targetName" placeholder="–ù–∞–∑–≤–∞ —Ü—ñ–ª—ñ" class="modal-input">
            <input type="number" id="targetSpeed" placeholder="–®–≤–∏–¥–∫—ñ—Å—Ç—å (–∫–º/–≥–æ–¥)" min="0" max="5000" class="modal-input">
            <input type="number" id="targetCourse" placeholder="–ö—É—Ä—Å (0-360¬∞)" min="0" max="360" class="modal-input">
            
            <select id="targetType" class="modal-input">
                <option value="–≤–∏–Ω–∏—â—É–≤–∞—á">üõ©Ô∏è –í–∏–Ω–∏—â—É–≤–∞—á</option>
                <option value="–¥—Ä–æ–Ω">üöÅ –î—Ä–æ–Ω (Shahed)</option>
                <option value="—Ä–∞–∫–µ—Ç–∞">üöÄ –†–∞–∫–µ—Ç–∞</option>
                <option value="–±–æ–º–±–∞">üí£ –ë–æ–º–±–∞</option>
                <option value="–∫–æ—Ä–∞–±–ª—å">üö¢ –ö–æ—Ä–∞–±–µ–ª—å</option>
                <option value="–≤–µ—Ä—Ç–æ–ª—ñ—Ç">üöÅ –í–µ—Ä—Ç–æ–ª—ñ—Ç</option>
                <option value="—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç">‚úàÔ∏è –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–∏–π –ª—ñ—Ç–∞–∫</option>
            </select>

            <div style="margin-top:20px; display: flex; gap: 10px; justify-content: space-between;">
                <button class="btn btn-success" onclick="saveTarget()">
                    <i class="fas fa-save"></i>–ó–±–µ—Ä–µ–≥—Ç–∏
                </button>
                <button class="btn btn-danger" onclick="deleteTarget()" id="deleteBtn">
                    <i class="fas fa-trash"></i>–í–∏–¥–∞–ª–∏—Ç–∏
                </button>
                <button class="btn" onclick="hideTargetForm()">
                    <i class="fas fa-times"></i>–°–∫–∞—Å—É–≤–∞—Ç–∏
                </button>
            </div>
        </div>
    </div>

    <!-- –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é -->
    <div class="context-menu" id="contextMenu">
        <div class="context-menu-item" onclick="contextEdit()">
            <i class="fas fa-edit"></i> –†–µ–¥–∞–≥—É–≤–∞—Ç–∏
        </div>
        <div class="context-menu-item" onclick="contextChangeCourse()">
            <i class="fas fa-compass"></i> –ó–º—ñ–Ω–∏—Ç–∏ –∫—É—Ä—Å
        </div>
        <div class="context-menu-item" onclick="contextDelete()">
            <i class="fas fa-trash"></i> –í–∏–¥–∞–ª–∏—Ç–∏
        </div>
    </div>

    <!-- –°—Ç–∞—Ç—É—Å –±–∞—Ä -->
    <div class="status-bar" id="statusBar">
        <div class="status-item">
            <i class="fas fa-circle" style="color: var(--success);"></i>
            <span>–°—Ç–∞—Ç—É—Å: –ê–∫—Ç–∏–≤–Ω–∏–π</span>
        </div>
        <div class="status-item">
            <i class="fas fa-crosshairs"></i>
            <span>–¶—ñ–ª–µ–π: <span id="statusTargets">0</span></span>
        </div>
        <div class="status-item">
            <i class="fas fa-clock"></i>
            <span>–ß–∞—Å: <span id="statusTime">00:00:00</span></span>
        </div>
    </div>

    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- –°–∫—Ä—ã—Ç—ã–π input –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ -->
    <input type="file" id="importFile" accept=".json" style="display:none">

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let map;
        let markers = {};
        let animationPaused = false;
        let courseMode = false;
        let addMode = false;
        let trailsVisible = true;
        let selectedTargetId = null;
        let currentMapView = 'street';
        let baseLayers = {};
        let targets = [];
        let animationInterval;
        let targetTrails = {};
        let targetHistory = {};
        let clickMarker = null;
        let lastFrameTime = performance.now();
        let hiddenTargets = new Set();
        let nextId = 1;
        let selectedTargets = new Set();
        let startTime = Date.now();
        let contextMenuTarget = null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã
        function initMap() {
            console.log("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã...");
            map = L.map('map').setView([50.4501, 30.5234], 6);

            // –°–ª–æ–∏ –∫–∞—Ä—Ç—ã
            baseLayers.street = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors',
                maxZoom: 19
            });

            baseLayers.satellite = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                attribution: '¬© Esri',
                maxZoom: 19
            });

            baseLayers.street.addTo(map);

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–∏—Å–∫–∞
            initSearch();

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            map.on('click', handleMapClick);
            map.on('moveend', updateVisibleTargets);
            map.on('contextmenu', handleContextMenu);

            // –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏
            initHotkeys();

            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
            loadTargets();
            startAnimation();
            updateStats();
            startUptimeCounter();

            showToast('–°–∏—Å—Ç–µ–º–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ —É—Å–ø—ñ—à–Ω–æ!', 'success');
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–æ–≤ –ø–æ –∫–∞—Ä—Ç–µ
        function handleMapClick(e) {
            if (addMode) {
                handleAddClick(e);
            } else if (courseMode && selectedTargetId !== null) {
                updateTargetCourse(e);
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω—é
        function handleContextMenu(e) {
            e.originalEvent.preventDefault();
            hideContextMenu();
        }

        // –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏
        function initHotkeys() {
            document.addEventListener('keydown', (e) => {
                if (e.target.tagName === 'INPUT') return;

                switch(e.code) {
                    case 'Space':
                        e.preventDefault();
                        togglePause();
                        break;
                    case 'KeyC':
                        if (e.ctrlKey) centerMap();
                        break;
                    case 'Delete':
                        if (selectedTargets.size > 0) {
                            deleteSelectedTargets();
                        }
                        break;
                    case 'Escape':
                        hideContextMenu();
                        hideTargetForm();
                        selectedTargets.clear();
                        updateGroupControls();
                        break;
                }
            });
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'exclamation' : 'info'}-circle"></i>
                ${message}
            `;
            
            document.getElementById('toastContainer').appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é
        function showContextMenu(e, targetId) {
            e.preventDefault();
            contextMenuTarget = targetId;
            
            const menu = document.getElementById('contextMenu');
            menu.style.display = 'block';
            menu.style.left = e.pageX + 'px';
            menu.style.top = e.pageY + 'px';
        }

        function hideContextMenu() {
            document.getElementById('contextMenu').style.display = 'none';
            contextMenuTarget = null;
        }

        function contextEdit() {
            if (contextMenuTarget) {
                showTargetForm(contextMenuTarget);
            }
            hideContextMenu();
        }

        function contextChangeCourse() {
            if (contextMenuTarget) {
                selectTargetForCourse(contextMenuTarget);
            }
            hideContextMenu();
        }

        function contextDelete() {
            if (contextMenuTarget) {
                const target = targets.find(t => t.id === contextMenuTarget);
                if (target && confirm(`–í–∏–¥–∞–ª–∏—Ç–∏ —Ü—ñ–ª—å "${target.name}"?`)) {
                    deleteTargetById(contextMenuTarget);
                }
            }
            hideContextMenu();
        }

        // –ì—Ä—É–ø–ø–æ–≤–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
        function showGroupControls() {
            document.getElementById('groupControls').style.display = 
                document.getElementById('groupControls').style.display === 'block' ? 'none' : 'block';
        }

        function updateGroupControls() {
            const count = selectedTargets.size;
            document.getElementById('selectedCount').textContent = `–í–∏–±—Ä–∞–Ω—ñ —Ü—ñ–ª—ñ: ${count}`;
            document.getElementById('groupControls').style.display = count > 0 ? 'block' : 'none';
        }

        function applyGroupSettings() {
            const speed = parseFloat(document.getElementById('groupSpeed').value);
            const course = parseFloat(document.getElementById('groupCourse').value);
            
            if (isNaN(speed) && isNaN(course)) {
                showToast('–í–≤–µ–¥—ñ—Ç—å —à–≤–∏–¥–∫—ñ—Å—Ç—å –∞–±–æ –∫—É—Ä—Å', 'warning');
                return;
            }

            selectedTargets.forEach(id => {
                const target = targets.find(t => t.id === id);
                if (target) {
                    if (!isNaN(speed)) target.speed = speed;
                    if (!isNaN(course)) target.course = course;
                }
            });

            updateMapMarkers();
            updateTargetsList();
            showToast(`–û–Ω–æ–≤–ª–µ–Ω–æ ${selectedTargets.size} —Ü—ñ–ª–µ–π`, 'success');
        }

        // –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (loadTargets, saveTargetsToStorage, updateStats, –∏ —Ç.–¥.)
        // ... [–ó–¥–µ—Å—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏] ...

        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤ moveTargets
        function moveTargets() {
            if (animationPaused) return;

            const now = performance.now();
            const deltaTime = (now - lastFrameTime) / 1000;
            lastFrameTime = now;

            targets.forEach(target => {
                // ... [–∫–æ–¥ –¥–≤–∏–∂–µ–Ω–∏—è] ...
            });

            updateStats(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats() {
            document.getElementById('totalTargets').textContent = targets.length;
            document.getElementById('visibleTargets').textContent = targets.length - hiddenTargets.size;
            
            const avgSpeed = targets.reduce((sum, target) => sum + target.speed, 0) / (targets.length || 1);
            document.getElementById('avgSpeed').textContent = `${Math.round(avgSpeed)} –∫–º/–≥–æ–¥`;
            
            document.getElementById('statusTargets').textContent = targets.length;
        }

        // –°—á–µ—Ç—á–∏–∫ –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞–±–æ—Ç—ã
        function startUptimeCounter() {
            setInterval(() => {
                const seconds = Math.floor((Date.now() - startTime) / 1000);
                const hours = Math.floor(seconds / 3600);
                const minutes = Math.floor((seconds % 3600) / 60);
                const secs = seconds % 60;
                
                document.getElementById('uptime').textContent = 
                    `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
                document.getElementById('statusTime').textContent = 
                    `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
            }, 1000);
        }

        // –ü–æ–º–æ—â—å
        function showHelp() {
            alert(`–ì–∞—Ä—è—á—ñ –∫–ª–∞–≤–∏—à—ñ:\n\nSpace - –ü–∞—É–∑–∞/–í—ñ–¥—Ç–≤–æ—Ä–∏—Ç–∏\nDelete - –í–∏–¥–∞–ª–∏—Ç–∏ –≤–∏–±—Ä–∞–Ω—ñ\nCtrl+C - –¶–µ–Ω—Ç—Ä—É–≤–∞—Ç–∏ –∫–∞—Ä—Ç—É\nEscape - –°–∫–∞—Å—É–≤–∞—Ç–∏\n\n–ö–ª–∞–≤—ñ—à–∞ –º–∏—à–∏ - –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–µ –º–µ–Ω—é`);
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = initMap;

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω—é –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
        document.addEventListener('click', hideContextMenu);
    </script>
</body>
</html>
